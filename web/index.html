<!--
  This file is part of NetConfig Lab Image Manager.

  NetConfig Lab Image Manager is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  NetConfig Lab Image Manager is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with NetConfig Lab Image Manager.  If not, see <https://www.gnu.org/licenses/>.
-->

<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8">
  <title>NetConfig Lab Image Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --bg-color: #020617;
      --card-bg: #020617;
      --accent: #38bdf8;
      --border-color: #1e293b;
      --text-main: #e5e7eb;
      --text-muted: #94a3b8;
      --badge-bg: rgba(15, 23, 42, 0.95);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%, #000 100%);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      width: 100%;
      max-width: 640px;
    }

    .card {
      background: linear-gradient(145deg, #020617 0%, #020617 60%, #020617 100%);
      border-radius: 18px;
      padding: 22px 22px 18px;
      box-shadow:
        0 18px 45px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.15);
      position: relative;
      overflow: hidden;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .header {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      align-items: center;
      margin-bottom: 10px;
    }

    .brand-left,
    .brand-right {
      display: flex;
      align-items: center;
    }

    .brand-left {
      justify-content: flex-start;
    }

    .brand-right {
      justify-content: flex-end;
    }

    .brand-logo {
      height: 32px;
      max-width: 110px;
      object-fit: contain;
      filter: drop-shadow(0 0 6px rgba(15, 23, 42, 0.9));
    }

    .project-title {
      text-align: center;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.04em;
      color: var(--text-main);
      white-space: nowrap;
    }

    .divider {
      margin: 12px 0 14px;
      border: none;
      border-top: 1px solid rgba(30, 41, 59, 0.9);
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .field-group {
      display: flex;
      gap: 10px;
    }

    .field-group .field {
      flex: 1;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    label {
      font-size: 12px;
      font-weight: 500;
      color: var(--text-muted);
    }

    input[type="text"],
    input[type="password"],
    input[type="file"],
    textarea {
      background-color: rgba(15, 23, 42, 0.85);
      border-radius: 10px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      padding: 8px 10px;
      font-size: 13px;
      color: var(--text-main);
      outline: none;
    }

    input[type="file"] {
      padding: 6px 10px;
    }

    textarea {
      font-size: 12px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      min-height: 160px;
      resize: vertical;
    }

    input::placeholder,
    textarea::placeholder {
      color: rgba(148, 163, 184, 0.7);
    }

    input:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
      background-color: rgba(15, 23, 42, 0.95);
    }

    .radio-group {
      display: flex;
      gap: 18px;
      align-items: center;
      flex-wrap: wrap;
    }

    .radio-group label {
      display: flex;
      align-items: center;
      gap: 4px;
      font-size: 13px;
      cursor: pointer;
      color: var(--text-main);
    }

    .radio-group input[type="radio"] {
      width: 15px;
      height: 15px;
    }

    .hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    .messages {
      margin-bottom: 8px;
    }

    .alert {
      border-radius: 10px;
      padding: 8px 10px;
      font-size: 12px;
      margin-bottom: 6px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background-color: rgba(15, 23, 42, 0.9);
      white-space: pre-wrap;
      word-break: break-word;
    }

    .alert-success {
      border-color: rgba(34, 197, 94, 0.7);
      background-color: rgba(22, 163, 74, 0.12);
      color: #bbf7d0;
    }

    .alert-error {
      border-color: rgba(248, 113, 113, 0.7);
      background-color: rgba(248, 113, 113, 0.12);
      color: #fecaca;
    }

    .progress-container {
      margin: 4px 0 4px;
      background-color: rgba(15, 23, 42, 0.9);
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      height: 12px;
      width: 100%;
      overflow: hidden;
      display: none;
    }

    .progress-bar {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #38bdf8, #0ea5e9, #1d4ed8);
      transition: width 0.15s ease-out;
    }

    .progress-label {
      font-size: 11px;
      color: var(--text-muted);
      margin-bottom: 2px;
      display: none;
    }

    .footer {
      margin-top: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .small-info {
      font-size: 11px;
      color: var(--text-muted);
      max-width: 260px;
      line-height: 1.4;
    }

    .btn-primary {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 13px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      background: radial-gradient(circle at 0 0, #38bdf8 0, #0ea5e9 35%, #1d4ed8 100%);
      color: white;
      cursor: pointer;
      box-shadow:
        0 10px 25px rgba(8, 47, 73, 0.9),
        0 0 0 1px rgba(56, 189, 248, 0.6);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    .btn-primary span.icon {
      font-size: 14px;
    }

    .btn-secondary {
      border-radius: 999px;
      padding: 7px 14px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      background: transparent;
      color: var(--text-muted);
      border: 1px solid rgba(148, 163, 184, 0.5);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .btn-secondary span.icon {
      font-size: 13px;
    }

    /* --- TABS --- */

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
    }

    .tab-button {
      padding: 8px 14px;
      background-color: rgba(15, 23, 42, 0.7);
      border: 1px solid rgba(56, 189, 248, 0.4);
      border-radius: 8px;
      cursor: pointer;
      color: #e5e7eb;
      font-size: 13px;
      font-weight: 600;
    }

    .tab-button.active {
      background-color: #0ea5e9;
      color: white;
      border-color: #0ea5e9;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* --- √ÅREA DE IMAGENS EXISTENTES --- */

    #imagesResultWrapper {
      margin-top: 12px;
    }

    #imagesResult {
      display: none;
      margin-top: 4px;
      padding: 10px 10px 8px;
      border-radius: 12px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 1) 0, #020617 60%);
      font-size: 12px;
      max-height: 260px;
      overflow-y: auto;
    }

    .images-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
    }

    .images-title-row span {
      font-size: 11px;
      color: var(--text-muted);
    }

    .images-sections {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .images-section {
      border-radius: 10px;
      padding: 8px 8px 6px;
      background-color: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(30, 64, 175, 0.4);
    }

    .images-section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 6px;
    }

    .images-section-main {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
    }

    .images-section-title {
      font-size: 12px;
      font-weight: 600;
    }

    .images-section-path {
      font-size: 10px;
      color: var(--text-muted);
    }

    .images-section-count {
      font-size: 10px;
      color: var(--accent);
      background-color: rgba(15, 23, 42, 1);
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(56, 189, 248, 0.4);
      white-space: nowrap;
    }

    .images-empty {
      font-size: 11px;
      color: var(--text-muted);
    }

    .vendor-group {
      margin-bottom: 6px;
    }

    .vendor-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 2px;
    }

    .vendor-name {
      font-size: 11px;
      font-weight: 600;
      text-transform: lowercase;
      color: var(--text-main);
    }

    .vendor-count {
      font-size: 10px;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .vendor-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-left: 2px;
    }

    .tag-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 7px;
      border-radius: 999px;
      background-color: rgba(15, 23, 42, 1);
      border: 1px solid rgba(51, 65, 85, 0.9);
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: var(--text-main);
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .tag-pill::before {
      content: "‚óÜ";
      font-size: 8px;
      margin-right: 4px;
      color: var(--accent);
    }

    /* --- LISTA DE TEMPLATES --- */

    .template-search-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    #template_search {
      flex: 1;
      min-width: 0;
    }

    #templatesList {
      margin-top: 6px;
      max-height: 220px;
      overflow-y: auto;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      border-radius: 10px;
      padding: 6px;
      border: 1px solid rgba(30, 64, 175, 0.4);
      background-color: rgba(15, 23, 42, 0.95);
    }

    .templates-empty {
      font-size: 11px;
      color: var(--text-muted);
    }

    .template-pill {
      display: inline-flex;
      align-items: center;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background-color: rgba(15, 23, 42, 1);
      font-size: 11px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      color: var(--text-main);
      cursor: pointer;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: background-color 0.12s ease-out, border-color 0.12s ease-out, transform 0.08s ease-out;
    }

    .template-pill:hover {
      border-color: rgba(56, 189, 248, 0.7);
      background-color: rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
    }

    .template-pill.active {
      border-color: rgba(56, 189, 248, 1);
      background-color: rgba(37, 99, 235, 0.7);
    }

    @media (max-width: 600px) {
      .card {
        padding: 20px 18px 16px;
      }

      .field-group {
        flex-direction: column;
      }

      .footer {
        flex-direction: column-reverse;
        align-items: stretch;
      }

      .small-info {
        max-width: 100%;
      }

      .btn-primary {
        justify-content: center;
        width: 100%;
      }

      .header {
        grid-template-columns: auto;
        row-gap: 8px;
        text-align: center;
      }

      .brand-left,
      .brand-right {
        justify-content: center;
      }

      .project-title {
        margin-top: 4px;
        white-space: normal;
      }

      .tabs {
        flex-wrap: wrap;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="card-inner">
        <div class="header">
          <div class="brand-left">
            <a href="https://www.hexanetworks.com.br" target="_blank" rel="noopener noreferrer">
              <img src="/static/img/hexa-logo.png" alt="Hexa Networks" class="brand-logo">
            </a>
          </div>

          <div class="project-title">
            NetConfig Lab Image Manager
          </div>

          <div class="brand-right">
            <a href="https://www.netconfig.com.br" target="_blank" rel="noopener noreferrer">
              <img src="/static/img/netconfig-logo.png" alt="NetConfig" class="brand-logo">
            </a>
          </div>
        </div>

        <hr class="divider">

        <div id="messages" class="messages"></div>

        <form id="uploadForm" enctype="multipart/form-data">
          <!-- CAMPOS COMUNS (USADOS EM IMAGES E TEMPLATES) -->
          <div class="field-group">
            <div class="field">
              <label>IP do EVE-NG</label>
              <input type="text" name="eve_ip" placeholder="Ex: 10.0.0.10" required>
            </div>
            <div class="field">
              <label>Usu√°rio SSH</label>
              <input type="text" name="eve_user" placeholder="Ex: root" required>
            </div>
          </div>

          <div class="field">
            <label>Senha SSH</label>
            <input type="password" name="eve_pass" placeholder="Senha do usu√°rio no EVE" required>
          </div>

          <!-- ABAS -->
          <div class="tabs">
            <button type="button" class="tab-button active" data-tab="images-tab">Images</button>
            <button type="button" class="tab-button" data-tab="templates-tab">Templates</button>
          </div>

          <!-- ==================== ABA IMAGES ==================== -->
          <div id="images-tab" class="tab-content active">
            <div class="field">
              <label>Tipo de imagem (Destino)</label>
              <div class="radio-group">
                <label><input type="radio" name="image_type" value="qemu" checked> QEMU</label>
                <label><input type="radio" name="image_type" value="iol"> IOL</label>
                <label><input type="radio" name="image_type" value="dynamips"> Dynamips</label>
              </div>
              <div class="hint">
                Isso s√≥ preenche o diret√≥rio base automaticamente. Voc√™ ainda pode editar abaixo.
              </div>
            </div>

            <div class="field">
              <label>Diret√≥rio base no EVE</label>
              <input type="text" name="eve_base_dir" id="eve_base_dir" value="/opt/unetlab/addons/qemu" required>
              <div class="hint">
                QEMU: <code>/opt/unetlab/addons/qemu</code> ¬∑ IOL: <code>/opt/unetlab/addons/iol/bin</code> ¬∑ Dynamips:
                <code>/opt/unetlab/addons/dynamips</code>.
              </div>
            </div>

            <div class="field">
              <label>Nome do Template (diret√≥rio)</label>
              <input type="text" name="template_name" placeholder="Ex: mikrotik-6.38.4" required>
            </div>

            <div class="field">
              <label>Imagens (pode selecionar v√°rias)</label>
              <input type="file" name="image" multiple required>
              <div class="hint">
                Use nomes como <code>hda.qcow2</code>, <code>hdb.qcow2</code>, <code>virtioa.qcow2</code>, etc.
              </div>
            </div>

            <div class="progress-label" id="progressText">Enviando...</div>
            <div class="progress-container" id="progressContainer">
              <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="footer">
              <div class="small-info">
                Selecione os arquivos e clique em enviar para publicar no seu EVE-NG.
              </div>
              <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <button type="button" class="btn-secondary" id="checkImagesBtn">
                  <span class="icon">üîç</span>
                  <span>Check Existent Images</span>
                </button>
                <button type="submit" class="btn-primary">
                  <span class="icon">‚¨Ü</span>
                  <span>Enviar imagens</span>
                </button>
              </div>
            </div>

            <div id="imagesResultWrapper">
              <div id="imagesResult"></div>
            </div>
          </div>
          <!-- ==================== FIM ABA IMAGES ==================== -->

          <!-- ==================== ABA TEMPLATES ==================== -->
          <div id="templates-tab" class="tab-content">
            <div class="field">
              <label>Templates existentes no EVE</label>
              <div class="template-search-row">
                <input type="text" id="template_search"
                  placeholder="Filtrar por nome (ex: huawei, juniper, mikrotik...)">
                <button type="button" class="btn-secondary" id="listTemplatesBtn">
                  <span class="icon">üìÇ</span>
                  <span>Listar templates</span>
                </button>
              </div>
              <div id="templatesList"></div>
              <div class="hint">
                Clique em um template da lista para carregar o conte√∫do no editor abaixo.
              </div>
            </div>

            <div class="field">
              <label>Nome do arquivo de template</label>
              <input type="text" name="template_yaml_name" id="template_yaml_name" placeholder="Ex: huaweine40.yml">
              <div class="hint">
                Se n√£o informar a extens√£o, ser√° usado <code>.yml</code> automaticamente.
              </div>
            </div>

            <div class="field">
              <label>Conte√∫do do template YAML</label>
              <textarea id="template_content" name="template_content"
                placeholder="# Cole ou edite aqui o conte√∫do YAML do template..."></textarea>
              <div class="hint">
                O arquivo ser√° enviado para:
                <code>/opt/unetlab/html/templates/amd</code> e
                <code>/opt/unetlab/html/templates/intel</code>.
              </div>
            </div>

            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px;">
              <button type="button" class="btn-secondary" id="loadTemplateBtn">
                <span class="icon">üì•</span>
                <span>Carregar template do EVE</span>
              </button>

              <button type="button" class="btn-secondary" id="saveTemplateBtn">
                <span class="icon">üíæ</span>
                <span>Salvar template no EVE</span>
              </button>
            </div>
          </div>
          <!-- ==================== FIM ABA TEMPLATES ==================== -->

        </form>
      </div>
    </div>
  </div>

  <script src="/static/js/main.js"></script>
</body>

</html>