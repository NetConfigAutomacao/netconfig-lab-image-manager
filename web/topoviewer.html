<!doctype html>
<html lang="en" id="root" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TopoViewer</title>

    <!-- Bundled CSS (includes Tailwind) -->
    <link rel="stylesheet" href="/static/topoviewer/topoViewerEditorStyles.css?ver=1" />

    
  </head>

  <body class="h-full w-full m-0 p-2 overflow-hidden font-sans text-sm">
    <nav class="navbar py-0 h-[4.5rem]" role="navigation" aria-label="main navigation">
  <!-- Left: Logo + Title -->
  <div class="navbar-brand flex items-center space-x-2 px-2">
    <a href="https://containerlab.dev/" target="_blank" rel="noopener noreferrer">
      <!-- <img id="nokia-logo-img" src="/static/topoviewer/images/containerlab.svg" alt="Containerlab Logo" class="h-12 w-auto block" />
        -->
      <svg
        text-rendering="geometricPrecision"
        shape-rendering="geometricPrecision"
        viewBox="65.95092024539876 14.95884 118.48159509202453 127.34192"
        xmlns:xlink="http://www.w3.org/1999/xlink"
        xmlns="http://www.w3.org/2000/svg"
        id="containerlab_export_white_ink"
        style="max-height: 500px"
        class="h-12 w-auto block"
      >
        <g
          transform="matrix(1 0 0 1 -79.26000213500001 -78.47828994999998)"
          id="containerlab_export_white_ink-text"
        >
          <g id="containerlab_export_white_ink-g873">
            <g id="containerlab_export_white_ink-g863">
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M121.530000,224.900000Q118.818000,224.900000,117.330000,226.796000Q115.842000,228.668000,115.842000,232.364000Q115.842000,236.156000,117.330000,237.908000Q118.818000,239.636000,121.530000,239.636000Q122.322000,239.636000,122.970000,239.492000Q123.642000,239.348000,124.194000,239.132000Q124.746000,238.916000,125.178000,238.652000Q125.610000,238.388000,125.922000,238.148000L126.618000,239.228000Q125.802000,239.924000,124.458000,240.452000Q123.138000,240.980000,121.434000,240.980000Q117.762000,240.980000,116.010000,238.748000Q114.258000,236.516000,114.258000,232.364000Q114.258000,230.396000,114.690000,228.788000Q115.146000,227.156000,116.034000,226.004000Q116.946000,224.852000,118.290000,224.228000Q119.658000,223.580000,121.482000,223.580000Q122.466000,223.580000,123.282000,223.772000Q124.098000,223.964000,124.722000,224.252000Q125.346000,224.516000,125.778000,224.828000Q126.234000,225.116000,126.498000,225.356000L125.730000,226.436000Q125.130000,225.932000,124.098000,225.428000Q123.066000,224.900000,121.530000,224.900000Z"
                id="containerlab_export_white_ink-path845"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M129.190000,232.270000Q129.190000,230.302000,129.646000,228.694000Q130.126000,227.062000,131.038000,225.910000Q131.950000,224.758000,133.294000,224.134000Q134.638000,223.486000,136.366000,223.486000Q138.094000,223.486000,139.414000,224.134000Q140.758000,224.758000,141.646000,225.910000Q142.558000,227.062000,143.014000,228.694000Q143.494000,230.302000,143.494000,232.270000Q143.494000,234.238000,143.014000,235.870000Q142.558000,237.478000,141.646000,238.654000Q140.758000,239.806000,139.414000,240.454000Q138.070000,241.078000,136.342000,241.078000Q134.614000,241.078000,133.270000,240.454000Q131.926000,239.806000,131.014000,238.654000Q130.126000,237.478000,129.646000,235.870000Q129.190000,234.238000,129.190000,232.270000ZM130.774000,232.270000Q130.774000,233.950000,131.110000,235.318000Q131.446000,236.662000,132.142000,237.646000Q132.838000,238.606000,133.870000,239.134000Q134.926000,239.662000,136.342000,239.662000Q137.758000,239.662000,138.790000,239.134000Q139.846000,238.606000,140.542000,237.646000Q141.238000,236.662000,141.574000,235.318000Q141.910000,233.950000,141.910000,232.270000Q141.910000,230.590000,141.574000,229.246000Q141.238000,227.878000,140.542000,226.918000Q139.846000,225.958000,138.790000,225.430000Q137.758000,224.902000,136.342000,224.902000Q134.926000,224.902000,133.870000,225.430000Q132.838000,225.958000,132.142000,226.918000Q131.446000,227.878000,131.110000,229.246000Q130.774000,230.590000,130.774000,232.270000Z"
                id="containerlab_export_white_ink-path847"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M149.630000,226.340000L149.630000,240.716000L148.166000,240.716000L148.166000,223.844000L149.750000,223.844000L158.126000,238.148000L158.126000,223.844000L159.590000,223.844000L159.590000,240.716000L158.126000,240.716000Z"
                id="containerlab_export_white_ink-path849"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M168.630000,225.260000L163.446000,225.260000L163.446000,223.844000L175.302000,223.844000L175.302000,225.260000L170.142000,225.260000L170.142000,240.716000L168.630000,240.716000Z"
                id="containerlab_export_white_ink-path851"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M185,236.010000L178.064000,236.010000L176.552000,240.714000L175.112000,240.714000L180.752000,223.842000L182.432000,223.842000L188.096000,240.714000L186.536000,240.714000ZM178.472000,234.690000L184.568000,234.690000L181.544000,225.570000Z"
                id="containerlab_export_white_ink-path853"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M193.050000,240.720000L191.538000,240.720000L191.538000,223.848000L193.050000,223.848000Z"
                id="containerlab_export_white_ink-path855"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M199.710000,226.340000L199.710000,240.716000L198.246000,240.716000L198.246000,223.844000L199.830000,223.844000L208.206000,238.148000L208.206000,223.844000L209.670000,223.844000L209.670000,240.716000L208.206000,240.716000Z"
                id="containerlab_export_white_ink-path857"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M214.890000,223.850000L224.202000,223.850000L224.202000,225.242000L216.402000,225.242000L216.402000,231.242000L222.498000,231.242000L222.498000,232.634000L216.402000,232.634000L216.402000,239.330000L224.442000,239.330000L224.442000,240.722000L214.890000,240.722000Z"
                id="containerlab_export_white_ink-path859"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(152,162,174)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M238.980000,240.720000L237.228000,240.720000L233.100000,233.784000L229.692000,233.784000L229.692000,240.720000L228.204000,240.720000L228.204000,223.848000L232.644000,223.848000Q234.156000,223.848000,235.164000,224.280000Q236.196000,224.712000,236.820000,225.432000Q237.444000,226.128000,237.708000,227.016000Q237.996000,227.880000,237.996000,228.768000Q237.996000,229.704000,237.732000,230.472000Q237.468000,231.240000,237.012000,231.816000Q236.556000,232.392000,235.932000,232.800000Q235.332000,233.208000,234.660000,233.448000ZM236.508000,228.840000Q236.508000,227.160000,235.548000,226.176000Q234.612000,225.192000,232.476000,225.192000L229.692000,225.192000L229.692000,232.464000L232.572000,232.464000Q234.612000,232.464000,235.548000,231.480000Q236.508000,230.496000,236.508000,228.840000Z"
                id="containerlab_export_white_ink-path861"
              />
            </g>
            <g id="containerlab_export_white_ink-g871">
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(0,201,255)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M242.420000,222.720000L244.556000,222.720000L244.556000,240.720000L242.420000,240.720000Z"
                id="containerlab_export_white_ink-path865"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(0,201,255)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M255.970000,235.130000Q255.946000,235.130000,255.658000,235.082000Q255.370000,235.034000,254.938000,235.010000Q254.506000,234.962000,254.002000,234.938000Q253.498000,234.890000,253.066000,234.890000Q252.298000,234.890000,251.746000,235.082000Q251.218000,235.274000,250.882000,235.610000Q250.546000,235.922000,250.378000,236.354000Q250.234000,236.786000,250.234000,237.290000Q250.234000,238.322000,250.906000,238.826000Q251.602000,239.330000,252.706000,239.330000Q253.306000,239.330000,253.882000,239.138000Q254.458000,238.946000,254.914000,238.610000Q255.394000,238.250000,255.682000,237.794000Q255.970000,237.314000,255.970000,236.738000ZM256.114000,240.722000L256.018000,239.378000Q255.466000,240.146000,254.410000,240.602000Q253.354000,241.034000,252.226000,241.034000Q251.506000,241.034000,250.786000,240.842000Q250.066000,240.650000,249.490000,240.218000Q248.914000,239.786000,248.530000,239.066000Q248.170000,238.346000,248.170000,237.290000Q248.170000,235.442000,249.370000,234.338000Q250.570000,233.234000,252.970000,233.234000Q253.354000,233.234000,253.834000,233.258000Q254.314000,233.282000,254.746000,233.330000Q255.178000,233.354000,255.514000,233.402000Q255.850000,233.426000,255.970000,233.450000L255.970000,232.706000Q255.970000,231.386000,255.178000,230.810000Q254.410000,230.234000,252.970000,230.234000Q251.674000,230.234000,250.762000,230.522000Q249.874000,230.810000,249.466000,231.050000L248.818000,229.538000Q249.034000,229.394000,249.418000,229.202000Q249.802000,229.010000,250.354000,228.842000Q250.930000,228.650000,251.650000,228.530000Q252.394000,228.410000,253.306000,228.410000Q255.490000,228.410000,256.762000,229.490000Q258.034000,230.546000,258.034000,232.586000L258.034000,240.722000Z"
                id="containerlab_export_white_ink-path867"
              />
              <path
                stroke-width="1"
                stroke="none"
                fill="rgb(0,201,255)"
                transform="matrix(1 0 0 1 10.55200000000002 18.97864700000000)"
                d="M262.190000,222.720000L264.326000,222.720000L264.326000,230.208000Q264.422000,229.992000,264.686000,229.704000Q264.974000,229.392000,265.430000,229.104000Q265.886000,228.816000,266.510000,228.624000Q267.134000,228.408000,267.950000,228.408000Q269.270000,228.408000,270.254000,228.888000Q271.238000,229.368000,271.886000,230.208000Q272.534000,231.048000,272.846000,232.176000Q273.158000,233.280000,273.158000,234.576000Q273.158000,236.352000,272.678000,237.576000Q272.198000,238.776000,271.430000,239.520000Q270.662000,240.264000,269.678000,240.600000Q268.718000,240.912000,267.734000,240.912000Q267.014000,240.912000,266.438000,240.768000Q265.886000,240.648000,265.454000,240.456000Q265.022000,240.264000,264.710000,240.048000Q264.422000,239.832000,264.254000,239.640000L264.158000,240.720000L262.190000,240.720000ZM267.446000,239.064000Q269.054000,239.064000,269.990000,238.008000Q270.950000,236.928000,270.950000,234.576000Q270.950000,233.664000,270.758000,232.896000Q270.566000,232.104000,270.158000,231.552000Q269.750000,230.976000,269.126000,230.664000Q268.526000,230.352000,267.686000,230.352000Q266.030000,230.352000,265.166000,231.504000Q264.302000,232.656000,264.302000,235.056000L264.302000,237.672000Q264.638000,238.128000,265.430000,238.608000Q266.246000,239.064000,267.446000,239.064000Z"
                id="containerlab_export_white_ink-path869"
              />
            </g>
          </g>
        </g>
        <g
          transform="matrix(1.27707402803300 0 0 1.27707402803300 -135.85348004729036 -121.99491568571256)"
          id="containerlab_export_white_ink-outer-container"
        >
          <g
            transform="matrix(1 0 0 1 0.07761382500030 0.06641805000012)"
            id="containerlab_export_white_ink-g843"
          >
            <g id="containerlab_export_white_ink-bubbles">
              <g
                style="
                  offset-path: path(
                    &quot;M205.884199,165.860001C197.074282,167.998330,195.705752,161.169993,195.705752,158.843356C195.597238,154.417121,207.484159,154.853512,204.543302,147.117108&quot;
                  );
                  offset-rotate: 0deg;
                "
                id="containerlab_export_white_ink-small-bubble_to"
              >
                <path
                  stroke-width="0.800000"
                  stroke="rgb(0,201,255)"
                  fill="none"
                  transform="scale(1.737107,1.656190) translate(-195.332199,-165.860001)"
                  d="M197.090000,165.860000C197.090000,166.332854,196.904804,166.786342,196.575152,167.120701C196.245501,167.455059,195.798398,167.642900,195.332200,167.642900C194.866002,167.642900,194.418899,167.455059,194.089248,167.120701C193.759596,166.786342,193.574400,166.332854,193.574400,165.860000C193.574400,165.387146,193.759596,164.933658,194.089248,164.599299C194.418899,164.264941,194.866002,164.077100,195.332200,164.077100C195.798398,164.077100,196.245501,164.264941,196.575152,164.599299C196.904804,164.933658,197.090000,165.387146,197.090000,165.860000"
                  id="containerlab_export_white_ink-small-bubble"
                />
              </g>
              <g
                style="
                  offset-path: path(
                    &quot;M197.413191,161.660004C199.739487,153.100729,206.577824,157.960197,206.367518,150.296087Q197.733947,137.765919,204.968877,131.776987&quot;
                  );
                  offset-rotate: 0deg;
                "
                id="containerlab_export_white_ink-mid-bubble_to"
              >
                <g transform="scale(1,1)" id="containerlab_export_white_ink-mid-bubble_ts">
                  <path
                    stroke-width="0.800000"
                    stroke="rgb(0,201,255)"
                    fill="none"
                    transform="translate(-186.861191,-161.660004)"
                    d="M189.620000,161.660000C189.620000,163.125211,188.384843,164.313000,186.861200,164.313000C185.337557,164.313000,184.102400,163.125211,184.102400,161.660000C184.102400,160.194789,185.337557,159.007000,186.861200,159.007000C188.384843,159.007000,189.620000,160.194789,189.620000,161.660000"
                    id="containerlab_export_white_ink-mid-bubble"
                  />
                </g>
              </g>
              <g
                style="
                  offset-path: path(
                    &quot;M202.937712,152.410004C210.676320,150.141269,203.420795,132.803737,202.846000,130.576097Q201.344264,117.338369,204.543310,117.443650&quot;
                  );
                  offset-rotate: 0deg;
                "
                id="containerlab_export_white_ink-big-bubble_to"
              >
                <g transform="scale(1,1)" id="containerlab_export_white_ink-big-bubble_ts">
                  <path
                    stroke-width="0.800000"
                    stroke="rgb(0,201,255)"
                    fill="none"
                    transform="translate(-192.385712,-152.410004)"
                    d="M196.490000,152.410000C196.490000,153.460523,196.057584,154.468018,195.287878,155.210850C194.518173,155.953682,193.474228,156.371000,192.385700,156.371000C191.297172,156.371000,190.253227,155.953682,189.483522,155.210850C188.713816,154.468018,188.281400,153.460523,188.281400,152.410000C188.281400,151.359477,188.713816,150.351982,189.483522,149.609150C190.253227,148.866318,191.297172,148.449000,192.385700,148.449000C193.474228,148.449000,194.518173,148.866318,195.287878,149.609150C196.057584,150.351982,196.490000,151.359477,196.490000,152.410000"
                    id="containerlab_export_white_ink-big-bubble"
                  />
                </g>
              </g>
            </g>
            <path
              stroke-width="1"
              stroke="none"
              fill="rgb(0,201,255)"
              transform="matrix(1 0 0 1 10.55200000000002 0)"
              d="M184.690000,168.960000C184.185000,169.173000,183.162000,169.812000,182.417000,170.380000C180.987000,171.471000,179.261000,171.742000,177.109000,171.214000C175.556000,170.833000,175.446000,171.282000,176.519000,173.615000C183.150000,188.035000,203.367000,188.511000,210.399000,174.414000C211.978000,171.249000,211.832000,170.694000,209.581000,171.316000C207.681000,171.840000,206.401000,171.543000,204.609000,170.159000C202.173000,168.278000,198.913000,168.276000,197.213000,170.155000C195.511000,172.036000,191.852000,171.948000,189.736000,169.977000C188.537000,168.859000,186.097000,168.368000,184.690000,168.960000"
              id="containerlab_export_white_ink-liquid"
            />
          </g>
          <path
            stroke-width="1"
            stroke="none"
            fill-rule="evenodd"
            fill="rgb(152,162,174)"
            transform="matrix(1 0 0 1 10.55200000000002 0)"
            d="M183.880000,108.030000C182.975000,108.336000,180.383000,109.681000,178.119000,111.020000C174.266000,113.298000,167.106000,117.405000,163.002000,119.692000C154.092000,124.657000,150.780000,126.932000,149.402000,129.032000L148.002000,131.167000L148.002000,179.167000L149.497000,181.401000C150.478000,182.867000,151.646000,184.005000,152.897000,184.712000C153.945000,185.305000,155.072000,185.961000,155.402000,186.169000C156.829000,187.070000,162.284000,190.167000,162.443000,190.167000C162.539000,190.167000,163.379000,190.657000,164.310000,191.257000C165.241000,191.856000,166.378000,192.550000,166.837000,192.800000C171.955000,195.575000,173.293000,196.343000,173.833000,196.815000C174.181000,197.119000,174.573000,197.367000,174.706000,197.367000C174.918000,197.367000,184.217000,202.726000,185.802000,203.760000C190.866000,207.068000,195.086000,207.316000,200.002000,204.597000C201.762000,203.623000,203.562000,202.628000,204.002000,202.386000C204.442000,202.144000,205.573000,201.450000,206.515000,200.844000C207.457000,200.237000,208.987000,199.349000,209.915000,198.870000C210.843000,198.391000,213.172000,197.047000,215.090000,195.883000C217.008000,194.719000,218.661000,193.767000,218.762000,193.767000C218.864000,193.767000,221.614000,192.191000,224.874000,190.264000C228.135000,188.337000,231.446000,186.423000,232.233000,186.010000C235.260000,184.422000,236.849000,183.058000,238.102000,180.969000L239.402000,178.802000L239.398000,155.185000L239.394000,131.567000L238.210000,129.501000C237.558000,128.365000,236.345000,126.960000,235.513000,126.380000C233.718000,125.126000,223.946000,119.429000,218.402000,116.404000C217.962000,116.163000,217.332000,115.762000,217.002000,115.512000C216.672000,115.261000,215.502000,114.577000,214.402000,113.990000C213.302000,113.404000,212.049000,112.709000,211.617000,112.446000C202.831000,107.089000,200.603000,106.557000,198.619000,109.343000C197.827000,110.455000,197.802000,111.012000,197.802000,127.549000L197.802000,144.608000L199.302000,145.205000C203.837000,147.012000,204.578000,147.414000,207.187000,149.483000C209.492000,151.312000,214.000800,157.840700,214.000800,159.044700C214.000800,159.338700,213.654000,158.593970,213.963000,159.081000C216.050000,162.378000,215.532000,170.454000,212.910000,175.496000C201.150000,198.109000,167.417000,185.996000,172.764000,161.079000C174.197000,154.401000,182.896000,145.510000,187.890000,145.367000C189.849000,145.310900,189.802000,144.583000,189.802000,127.458000C189.802000,110.441000,189.769000,110.106000,187.943000,108.522000C186.824000,107.552000,185.697000,107.416000,183.880000,108.030000M185.457000,123.404000C185.469000,129.214000,185.461000,135.695000,185.440000,137.806000L185.402000,141.645000L182.424000,143.117000C158.291000,155.044000,166.727000,191.491000,193.602000,191.407000C220.979000,191.322000,229.072000,155.307000,204.515000,142.842000L202.002000,141.567000L202.002000,112.367000L202.981000,112.476000C203.519000,112.536000,204.239000,112.826000,204.581000,113.120000C204.922000,113.413000,206.436000,114.323000,207.945000,115.141000C209.453000,115.959000,211.841000,117.334000,213.252000,118.197000C214.662000,119.061000,215.887000,119.767000,215.975000,119.767000C216.231000,119.767000,228.987000,127.194000,231.574000,128.849000C235.811000,131.561000,235.587000,130.140000,235.696000,154.967000L235.791000,176.367000L234.866000,178.167000C233.953000,179.942000,232.343000,181.304000,229.202000,182.956000C227.541000,183.829000,226.700000,184.321000,225.004000,185.410000C224.453000,185.764000,222.922000,186.649000,221.602000,187.376000C217.875000,189.429000,217.201000,189.816000,210.802000,193.571000C207.502000,195.508000,204.082000,197.480000,203.202000,197.953000C202.322000,198.426000,200.144000,199.658000,198.363000,200.690000C193.439000,203.543000,193.350000,203.521000,182.003000,196.684000C181.563000,196.419000,180.769000,196.007000,180.239000,195.770000C179.710000,195.533000,178.486000,194.805000,177.519000,194.153000C176.553000,193.501000,175.626000,192.967000,175.460000,192.967000C175.294000,192.967000,174.268000,192.398000,173.180000,191.702000C171.072000,190.353000,163.795000,186.167000,163.558000,186.167000C163.481000,186.167000,162.465000,185.582000,161.300000,184.867000C160.135000,184.152000,158.827000,183.349000,158.392000,183.082000C157.958000,182.815000,156.832000,182.196000,155.891000,181.706000C154.950000,181.216000,153.690000,180.174000,153.091000,179.391000L152.002000,177.967000L152.002000,132.347000L152.912000,131.191000C153.756000,130.118000,158.031000,127.004000,158.695000,126.978000C158.856000,126.972000,160.164000,126.247000,161.602000,125.367000C163.040000,124.487000,164.310000,123.767000,164.425000,123.767000C164.540000,123.767000,165.122000,123.432000,165.718000,123.023000C166.848000,122.248000,176.531000,116.640000,180.002000,114.752000C181.102000,114.153000,182.272000,113.435000,182.602000,113.156000C183.346000,112.528000,184.696000,112.215000,185.119000,112.573000C185.293000,112.720000,185.445000,117.594000,185.457000,123.404000"
            id="containerlab_export_white_ink-path877"
          />
        </g>
      </svg>
      <style>
        #containerlab_export_white_ink * {
          animation-play-state: paused !important;
          animation-fill-mode: none !important;
        }

        #containerlab_export_white_ink:hover * {
          animation-play-state: running !important;
        }

        #containerlab_export_white_ink-small-bubble_to {
          animation: containerlab_export_white_ink-small-bubble_to__to 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-small-bubble_to__to {
          0% {
            offset-distance: 0%;
          }

          50% {
            offset-distance: 50%;
          }

          100% {
            offset-distance: 100%;
          }
        }

        #containerlab_export_white_ink-small-bubble {
          animation: containerlab_export_white_ink-small-bubble_c_o 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-small-bubble_c_o {
          0% {
            opacity: 1;
          }

          100% {
            opacity: 0.68;
          }
        }

        #containerlab_export_white_ink-mid-bubble_to {
          animation: containerlab_export_white_ink-mid-bubble_to__to 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-mid-bubble_to__to {
          0% {
            offset-distance: 0%;
          }

          50% {
            offset-distance: 50%;
          }

          100% {
            offset-distance: 100%;
          }
        }

        #containerlab_export_white_ink-mid-bubble_ts {
          animation: containerlab_export_white_ink-mid-bubble_ts__ts 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-mid-bubble_ts__ts {
          0% {
            transform: scale(1, 1);
          }

          30% {
            transform: scale(1.177208, 1.230592);
          }

          50% {
            transform: scale(1.387962, 1.447246);
          }

          100% {
            transform: scale(0.890084, 0.990101);
          }
        }

        #containerlab_export_white_ink-mid-bubble {
          animation: containerlab_export_white_ink-mid-bubble_c_o 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-mid-bubble_c_o {
          0% {
            opacity: 1;
          }

          100% {
            opacity: 0.6;
          }
        }

        #containerlab_export_white_ink-big-bubble_to {
          animation: containerlab_export_white_ink-big-bubble_to__to 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-big-bubble_to__to {
          0% {
            offset-distance: 0%;
          }

          50% {
            offset-distance: 50%;
          }

          100% {
            offset-distance: 100%;
          }
        }

        #containerlab_export_white_ink-big-bubble_ts {
          animation: containerlab_export_white_ink-big-bubble_ts__ts 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-big-bubble_ts__ts {
          0% {
            transform: scale(1, 1);
          }

          10% {
            transform: scale(0.833855, 0.806136);
          }

          20% {
            transform: scale(0.751891, 0.728111);
          }

          50% {
            transform: scale(0.59774, 0.60704);
          }

          100% {
            transform: scale(0.59774, 0.60704);
          }
        }

        #containerlab_export_white_ink-big-bubble {
          animation: containerlab_export_white_ink-big-bubble_c_o 1000ms linear infinite normal
            forwards;
        }

        @keyframes containerlab_export_white_ink-big-bubble_c_o {
          0% {
            opacity: 1;
          }

          100% {
            opacity: 0.06;
          }
        }
      </style>
    </a>
    <div class="flex flex-col leading-tight pl-0">
      <span class="text-xl font-medium">TopoViewer</span>
      <span class="inline-flex items-center gap-x-1">
        <span
          id="mode-indicator"
          class="mode-editor inline-flex items-center px-1 py-0.5 text-xs font-light rounded uppercase text-white"
        >
          editor
        </span>
        <span class="leading-none font-light">Â· ContainerLab Topology</span>
      </span>
    </div>
  </div>

  <div id="viewport-buttons">
    <div class="flex flex-row justify-evenly space-x-1"><div class="m-0 p-0">
  <button
    id="viewport-lab-settings"
    title="Lab Settings"
    onclick="viewportButtonsLabSettings(event)"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fas fa-gear"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-zoom-to-fit"
    title="Fit to Viewport"
    onclick="viewportButtonsZoomToFit(event)"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fas fa-expand"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-toggle-split"
    title="Toggle YAML Split View"
    onclick="viewportButtonsToggleSplit(event)"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fas fa-columns"></i>
    </span>
  </button>
</div>



<div class="m-0 p-0">
  <button
    id="viewport-layout"
    title="Layout Manager"
    onclick="viewportButtonsLayoutAlgo(event)"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fas fa-circle-nodes"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-topology-overview"
    title="Find Node"
    onclick="viewportButtonsTopologyOverview(event)"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-binoculars"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <div class="relative inline-block">
    <button
      id="viewport-link-label-button"
      title="Link labels"
      aria-haspopup="true"
      aria-expanded="false"
      onclick="viewportToggleLinkLabelMenu(event)"
      class="btn-icon-hover-clean"
    >
      <span class="inline-flex items-center justify-center text-xl">
        <i class="fas fa-tag"></i>
      </span>
    </button>
    <div
      id="viewport-link-label-menu"
      class="navbar-menu hidden"
      role="menu"
      aria-labelledby="viewport-link-label-button"
    >
      <button
        type="button"
        class="navbar-menu-option"
        data-mode="show-all"
        onclick="viewportSelectLinkLabelMode('show-all')"
        role="menuitemradio"
        aria-checked="false"
      >
        <span>Show Labels</span>
        <i class="fa-solid fa-check navbar-menu-option-check" aria-hidden="true"></i>
      </button>
      <button
        type="button"
        class="navbar-menu-option"
        data-mode="on-select"
        onclick="viewportSelectLinkLabelMode('on-select')"
        role="menuitemradio"
        aria-checked="false"
      >
        <span>Show Link Labels on Select</span>
        <i class="fa-solid fa-check navbar-menu-option-check" aria-hidden="true"></i>
      </button>
      <button
        type="button"
        class="navbar-menu-option"
        data-mode="hide"
        onclick="viewportSelectLinkLabelMode('hide')"
        role="menuitemradio"
        aria-checked="false"
      >
        <span>No Labels</span>
        <i class="fa-solid fa-check navbar-menu-option-check" aria-hidden="true"></i>
      </button>
      <hr class="my-1 border-t border-default" />
      <button
        type="button"
        id="viewport-dummy-links-toggle"
        class="navbar-menu-option"
        data-visible="true"
        onclick="viewportToggleDummyLinks(event)"
        role="menuitemcheckbox"
        aria-checked="true"
      >
        <span>Show Dummy Links</span>
        <i class="fa-solid fa-check navbar-menu-option-check" aria-hidden="true"></i>
      </button>
    </div>
  </div>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-capture-viewport"
    title="Capture Viewport as SVG"
    onclick="viewportButtonsCaptureViewportAsSvg()"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-camera"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-shortcuts"
    title="Shortcuts"
    onclick="showShortcutsModal()"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-keyboard"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="toggle-shortcut-display"
    title="Toggle Shortcut Display"
    onclick="toggleShortcutDisplay()"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i id="eye-icon" class="fa-solid fa-eye-slash"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-about"
    title="About TopoViewer"
    onclick="showPanelAbout()"
    class="btn-icon-hover-clean"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-circle-info"></i>
    </span>
  </button>
</div>

<hr id="viewport-geo-map-divider" class="my-1 viewport-geo-map hidden border-t border-default" />

<div class="m-0 p-0">
  <button
    id="viewport-geo-map-pan"
    title="#"
    onclick="viewportButtonsGeoMapPan(event)"
    class="btn-icon-hover-clean viewport-geo-map hidden"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-hand"></i>
    </span>
  </button>
</div>

<div class="m-0 p-0">
  <button
    id="viewport-geo-map-edit"
    title="#"
    onclick="viewportButtonsGeoMapEdit(event)"
    class="btn-icon-hover-clean viewport-geo-map hidden"
  >
    <span class="inline-flex items-center justify-center text-xl">
      <i class="fa-solid fa-arrow-pointer"></i>
    </span>
  </button>
</div>
</div>
  </div>
  <div
    id="navbar-loading-indicator"
    class="navbar-loading-indicator hidden"
    role="presentation"
    aria-hidden="true"
  >
    <div class="navbar-loading-indicator__bar"></div>
  </div>
</nav>

<style>
  #mode-indicator.mode-viewer {
    background-color: #10b981;
    /* green-500 */
  }

  #mode-indicator.mode-editor {
    background-color: #3b82f6;
    /* blue-500 */
  }
</style>


    <div id="root-div" class="absolute inset-0 z-10">
      <div id="cy-leaflet" class="absolute inset-0 p-0 z-0 hidden"></div>

      <div id="cy" tabindex="0" class="absolute inset-0 p-0 z-10"></div>

      <div
        id="shortcut-display"
        class="fixed bottom-4 left-4 flex flex-col-reverse items-start space-y-reverse space-y-1 z-[100000]"
      ></div>

      <!-- prettier-ignore -->
      <!-- Layout Drawer Panel -->
<div
  id="viewport-drawer-layout"
  class="panel viewport-drawer fixed top-[4.5rem] right-[1rem] w-[300px] h-[288px] z-[90] p-1"
  style="display: none"
>
  <div class="p-2 pb-2">
    <div class="flex flex-col">
      <div class="pb-0">
        <label class="vscode-label vscode-section-header">Layout</label>
      </div>
      <div class="pb-0">
        <div class="mb-2 vscode-label">
          <p>This panel allows computing new coordinates to nodes of the graph.</p>
        </div>
        <!-- Grid settings: Line width -->
        <div class="flex items-center mb-2">
          <label class="vscode-label w-28 text-right pr-3">Grid line width</label>
          <input
            id="viewport-drawer-grid-line-width"
            class="flex-1"
            type="range"
            step="0.05"
            min="0.00001"
            max="2.00"
            value="0.5"
            oninput="viewportDrawerGridLineWidthChange(this.value)"
          />
          <button
            type="button"
            class="btn btn-secondary btn-small ml-2"
            title="Reset to default (0.5)"
            onclick="viewportDrawerGridLineWidthReset()"
          >
            Reset
          </button>
        </div>
        <div class="relative">
          <select
            id="select-layout-algo"
            onchange="layoutAlgoChange(event)"
            class="input-field text-sm"
          >
            <option>Select Layout Algorithm</option>
            <option>Force Directed Radial</option>
            <option>Vertical</option>
            <option>Horizontal</option>
            <option>Preset</option>
            <option>Geo Positioning</option>
          </select>
        </div>
      </div>
    </div>
  </div>

  <!-- Force Directed Controls -->
  <div class="layout-algo p-2 hidden" id="viewport-drawer-force-directed">
    <div class="space-y-2">
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Link Length</label>
        <input
          id="force-directed-slider-link-lenght"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="1000"
        />
      </div>
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Node Gap</label>
        <input
          id="force-directed-slider-node-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="10"
        />
      </div>
    </div>
  </div>

  <div class="layout-algo p-2 pb-2 hidden" id="viewport-drawer-force-directed-reset-start">
    <button
      onclick="viewportDrawerLayoutForceDirected(event)"
      class="btn btn-primary btn-small float-right"
    >
      Enable
    </button>
  </div>

  <!-- Force Directed Radial Controls -->
  <div class="layout-algo p-2 hidden" id="viewport-drawer-force-directed-radial">
    <div class="space-y-2">
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">
          Link
          <br />
          Length
        </label>
        <input
          id="force-directed-radial-slider-link-lenght"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="500"
        />
      </div>
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Node Gap</label>
        <input
          id="force-directed-radial-slider-node-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="100"
        />
      </div>
    </div>
  </div>
  <div class="layout-algo p-2 pb-2 hidden" id="viewport-drawer-force-directed-radial-reset-start">
    <button
      onclick="viewportDrawerLayoutForceDirectedRadial(event)"
      class="btn btn-primary btn-small float-right"
    >
      Enable
    </button>
  </div>

  <!-- Vertical Layout Controls -->
  <div class="layout-algo p-2 hidden" id="viewport-drawer-dc-vertical">
    <div class="space-y-2">
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Node v-Gap</label>
        <input
          id="vertical-layout-slider-node-v-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="10"
        />
      </div>
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Group v-Gap</label>
        <input
          id="vertical-layout-slider-group-v-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="100"
        />
      </div>
    </div>
  </div>
  <div class="layout-algo p-2 pb-2 hidden" id="viewport-drawer-dc-vertical-reset-start">
    <button
      onclick="viewportDrawerLayoutVertical(event)"
      class="btn btn-primary btn-small float-right"
    >
      Enable
    </button>
  </div>

  <!-- Horizontal Layout Controls -->
  <div class="layout-algo p-2 hidden" id="viewport-drawer-dc-horizontal">
    <div class="space-y-2">
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Node h-Gap</label>
        <input
          id="horizontal-layout-slider-node-h-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="10"
        />
      </div>
      <div class="flex items-center">
        <label class="vscode-label w-24 text-right pr-3">Group h-Gap</label>
        <input
          id="horizontal-layout-slider-group-h-gap"
          class="flex-1"
          type="range"
          step="1"
          min="1"
          max="100"
        />
      </div>
    </div>
  </div>
  <div class="layout-algo p-2 pb-2 hidden" id="viewport-drawer-dc-horizontal-reset-start">
    <button
      onclick="viewportDrawerLayoutHorizontal(event)"
      class="btn btn-primary btn-small float-right"
    >
      Enable
    </button>
  </div>

  <!-- Geo Map Controls -->
  <div class="layout-algo p-2 hidden" id="viewport-drawer-geo-map-content-01">
    <!-- Empty for now -->
  </div>

  <div class="layout-algo p-2 hidden" id="viewport-drawer-geo-map">
    <div class="vscode-label text-secondary">
      <div class="px-0 py-0 max-h-[100px] overflow-y-auto">
        <div class="pb-2">
          <p>
            <strong>Hint:</strong>
            <br />
          </p>
          <p>
            Click the
            <i class="fa-solid fa-hand"></i>
            <strong>Pan</strong>
            icon to navigate the map, or the
            <i class="fa-solid fa-arrow-pointer"></i>
            <strong>Edit</strong>
            icon to interact with nodes and edges. Both icons are located in the viewport buttons.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

      <!-- Topology Overview Drawer -->
<div
  id="viewport-drawer-topology-overview"
  class="panel viewport-drawer fixed top-[4.5rem] right-[1rem] w-[300px] z-[90] p-1"
  style="display: none"
>
  <div class="p-2 pb-2">
    <div class="flex flex-col">
      <div class="pb-0">
        <label class="vscode-label vscode-section-header">Topology Overview</label>
      </div>
      <div class="pb-0">
        <div class="mb-2 vscode-label">
          <p>This panel allows to search node in the topology.</p>
        </div>
      </div>
    </div>
  </div>
  <div class="layout-algo p-2 block" id="viewport-drawer-topology-overview-content">
    <div class="space-y-3">
      <div>
        <div class="relative">
          <input
            type="text"
            id="viewport-drawer-topology-overview-content-edit"
            placeholder="Search for nodes ..."
            class="input-field pl-8 pr-3 text-sm"
            autofocus
          />
          <span class="absolute left-2 top-1/2 transform -translate-y-1/2">
            <i class="fas fa-search" aria-hidden="true"></i>
          </span>
        </div>
      </div>
      <script>
        (function () {
          const drawer = document.getElementById("viewport-drawer-topology-overview");
          const input = document.getElementById("viewport-drawer-topology-overview-content-edit");
          if (!drawer || !input) return;
          const focusInput = () =>
            setTimeout(() => {
              input.focus();
              input.select();
            }, 50);
          if (getComputedStyle(drawer).display !== "none") focusInput();
          new MutationObserver(() => {
            if (getComputedStyle(drawer).display !== "none") focusInput();
          }).observe(drawer, { attributes: true, attributeFilter: ["style", "class"] });
          drawer.addEventListener("open", focusInput);
          // CTRL/CMD + F to open overview
          document.addEventListener(
            "keydown",
            (ev) => {
              if ((ev.ctrlKey || ev.metaKey) && ev.key && ev.key.toLowerCase() === "f") {
                if (getComputedStyle(drawer).display === "none") {
                  drawer.style.display = "block";
                  focusInput();
                }
              }
            },
            { passive: false }
          );
        })();
      </script>
      <div>
        <button class="btn btn-primary btn-small" onclick="viewportNodeFindEvent()">
          Search Node
        </button>
      </div>
    </div>
  </div>
</div>

      <!-- Export SVG Drawer -->
<div
  id="viewport-drawer-capture-sceenshoot"
  class="panel viewport-drawer fixed top-[4.5rem] right-[1rem] w-[300px] z-[90] p-1"
  style="display: none"
>
  <div class="p-2 pb-2">
    <div class="flex flex-col">
      <div class="pb-0">
        <label class="vscode-label vscode-section-header">Export SVG</label>
      </div>
      <div class="pb-0">
        <div class="mb-2 vscode-label">
          <p>Configure options for exporting the topology as an SVG.</p>
        </div>
      </div>
    </div>
  </div>
  <div id="viewport-drawer-capture-sceenshoot-content" class="layout-algo p-2 block">
    <div class="space-y-3">
      <div class="flex items-center">
        <label class="vscode-label w-32 text-right pr-3">Border Zoom (%)</label>
        <input
          id="export-border-zoom"
          type="number"
          class="input-field text-sm w-24"
          value="100"
          min="10"
          max="300"
        />
      </div>
      <div class="flex items-center">
        <label class="vscode-label w-32 text-right pr-3">Border Padding (px)</label>
        <input
          id="export-border-padding"
          type="number"
          class="input-field text-sm w-24"
          value="0"
          min="0"
        />
      </div>
    </div>
  </div>
  <div class="layout-algo p-2 pb-2 block" id="viewport-drawer-capture-sceenshoot-button">
    <div class="flex justify-end gap-2">
      <button onclick="viewportDrawerCaptureFunc(event)" class="btn btn-primary btn-small">
        Export
      </button>
    </div>
  </div>
</div>

      <!-- Node Properties Panel -->
<section
  class="panel panel-overlay bottom-10 left-20 draggable-panel overflow-hidden"
  id="panel-node"
  aria-labelledby="node-panel-heading"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="node-panel-heading">
    <span class="panel-title">Node Properties</span>
    <button class="panel-close-btn" id="panel-node-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="p-4">
    <!-- Grid layout: 3 columns, auto rows -->
    <div class="grid grid-cols-3 gap-4">
      <!-- Row 1: Name (spans full width) -->
      <div class="flex flex-col items-center col-span-3">
        <span class="vscode-label text-xs mb-1 font-bold">Name</span>
        <span id="panel-node-name" class="text-sm text-[var(--vscode-foreground)] text-center">
          N/A
        </span>
      </div>

      <!-- Row 2: Kind, State -->
      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">Kind</span>
        <span id="panel-node-kind" class="text-sm text-[var(--vscode-foreground)] text-center">
          N/A
        </span>
      </div>

      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">State</span>
        <span id="panel-node-state" class="text-sm text-[var(--vscode-foreground)] text-center">
          N/A
        </span>
      </div>

      <!-- Row 2: Image, Mgmt IPv4, Mgmt IPv6 -->
      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">Image</span>
        <span
          id="panel-node-image"
          class="text-sm text-[var(--vscode-foreground)] text-center break-all"
        >
          N/A
        </span>
      </div>

      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">Mgmt IPv4</span>
        <span id="panel-node-mgmtipv4" class="text-sm text-[var(--vscode-foreground)] text-center">
          N/A
        </span>
      </div>

      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">Mgmt IPv6</span>
        <span id="panel-node-mgmtipv6" class="text-sm text-[var(--vscode-foreground)] text-center">
          N/A
        </span>
      </div>

      <!-- Row 4: FQDN -->
      <div class="flex flex-col items-center">
        <span class="vscode-label text-xs mb-1 font-bold">FQDN</span>
        <span
          id="panel-node-fqdn"
          class="text-sm text-[var(--vscode-foreground)] text-center break-all"
        >
          N/A
        </span>
      </div>
    </div>
  </div>
</section>

      <!-- Node Parent Properties Editor Panel -->
<section
  class="panel panel-overlay panel-editor fixed bottom-10 left-20 overflow-hidden z-[21] draggable-panel flex flex-col"
  id="panel-node-editor-parent"
  aria-labelledby="group-panel-heading"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="group-panel-heading">
    <span class="panel-title">Group Editor</span>
    <button class="panel-close-btn" id="panel-group-editor-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="panel-block p-2 overflow-y-auto" id="group-editor-content">
    <div class="space-y-3">
      <!-- Basic Information Section -->
      <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
        <div class="vscode-section-header mb-2">Basic Information</div>

        <!-- Group Id -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Group Name</label>
          <!-- <div class="text-left font-extralight text-base break-words" id="panel-node-editor-parent-graph-group-id">
            group-id-placeholder
          </div> -->

          <div>
            <span
              id="panel-node-editor-parent-graph-group-id"
              class="text-base px-2 py-1 inline-block rounded"
              style="
                background-color: var(--vscode-textBlockQuote-background);
                border: 1px solid var(--vscode-textBlockQuote-border);
              "
            ></span>
          </div>
        </div>

        <!-- Group Label -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Group Label</label>
          <input
            type="text"
            class="input-field text-base w-full"
            id="panel-node-editor-parent-graph-group"
          />
        </div>

        <!-- Graph Level -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Graph Level</label>
          <input
            type="text"
            class="input-field text-base w-full"
            id="panel-node-editor-parent-graph-level"
          />
        </div>

        <!-- Label Position -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Label Position</label>
          <div class="relative" id="panel-node-editor-parent-label-dropdown">
            <button class="btn btn-small inline-flex items-center font-extralight">
              <span id="panel-node-editor-parent-label-dropdown-button-text">Select Position</span>
              <span class="ml-2 font-extralight text-base">
                <i class="fas fa-angle-down" aria-hidden="true"></i>
              </span>
            </button>
            <div
              class="dropdown-menu hidden absolute top-full left-0 mt-1 w-full max-h-30 overflow-y-auto overscroll-contain z-[60]"
              id="panel-node-editor-parent-label-dropdown-menu"
            >
              <div class="py-1 font-extralight text-base">
                <a href="#" class="py-1 dropdown-item">top-center</a>
                <a href="#" class="py-1 dropdown-item">top-left</a>
                <a href="#" class="py-1 dropdown-item">top-right</a>
                <a href="#" class="py-1 dropdown-item">bottom-center</a>
                <a href="#" class="py-1 dropdown-item">bottom-left</a>
                <a href="#" class="py-1 dropdown-item">bottom-right</a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Visual Appearance Section -->
      <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
        <div class="vscode-section-header mb-2">Visual Appearance</div>

        <!-- Background Color -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Background</label>
          <div class="flex items-center space-x-2">
            <input
              type="color"
              class="input-field h-8 w-8 cursor-pointer border border-gray-500"
              id="panel-node-editor-parent-bg-color"
            />
            <input
              type="text"
              class="input-field text-base flex-1"
              id="panel-node-editor-parent-bg-color-hex"
              maxlength="7"
              placeholder="#RRGGBB"
            />
          </div>
        </div>

        <!-- Background Opacity -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Bg Opacity</label>
          <div class="flex items-center space-x-2">
            <input
              type="range"
              min="0"
              max="100"
              value="20"
              class="flex-1"
              id="panel-node-editor-parent-bg-opacity"
            />
            <span class="text-sm w-10 text-right" id="panel-node-editor-parent-bg-opacity-value">
              20%
            </span>
          </div>
        </div>

        <!-- Text Color -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Text Color</label>
          <div class="flex items-center space-x-2">
            <input
              type="color"
              class="input-field h-8 w-8 cursor-pointer border border-gray-500"
              id="panel-node-editor-parent-text-color"
            />
            <input
              type="text"
              class="input-field text-base flex-1"
              id="panel-node-editor-parent-text-color-hex"
              maxlength="7"
              placeholder="#RRGGBB"
            />
          </div>
        </div>
      </div>

      <!-- Border Settings Section -->
      <div>
        <div class="vscode-section-header mb-2">Border Settings</div>

        <!-- Border Color -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Border Color</label>
          <div class="flex items-center space-x-2">
            <input
              type="color"
              class="input-field h-8 w-8 cursor-pointer border border-gray-500"
              id="panel-node-editor-parent-border-color"
            />
            <input
              type="text"
              class="input-field text-base flex-1"
              id="panel-node-editor-parent-border-color-hex"
              maxlength="7"
              placeholder="#RRGGBB"
            />
          </div>
        </div>

        <!-- Border Width -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Border Width</label>
          <input
            type="number"
            step="0.1"
            class="input-field text-base w-full"
            id="panel-node-editor-parent-border-width"
          />
        </div>

        <!-- Border Style -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Border Style</label>
          <select class="input-field text-base w-full" id="panel-node-editor-parent-border-style">
            <option value="solid">Solid</option>
            <option value="dotted">Dotted</option>
            <option value="dashed">Dashed</option>
            <option value="double">Double</option>
          </select>
        </div>

        <!-- Border Radius -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Corner Radius</label>
          <div class="flex items-center space-x-2">
            <input
              type="range"
              min="0"
              max="50"
              value="0"
              class="flex-1"
              id="panel-node-editor-parent-border-radius"
            />
            <span class="text-sm w-10 text-right" id="panel-node-editor-parent-border-radius-value">
              0px
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Footer with OK/Apply buttons -->
  <div
    class="panel-block flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--vscode-panel-border)] bg-[var(--vscode-sideBar-background)] flex-shrink-0"
    id="group-editor-footer"
  >
    <button
      class="btn btn-primary btn-small"
      id="panel-node-editor-parent-ok-button"
      title="Apply changes and close"
    >
      OK
    </button>
    <button
      class="btn btn-outlined btn-small"
      id="panel-node-editor-parent-apply-button"
      title="Apply changes without closing"
    >
      Apply
    </button>
  </div>
</section>

<style>
  input[type="color"] {
    -webkit-appearance: none;
    appearance: none;
    padding: 0;
  }

  input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
  }

  input[type="color"]::-webkit-color-swatch {
    border: none;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Resize observer to calculate content height
    const panel = document.getElementById("panel-node-editor-parent");
    const content = document.getElementById("group-editor-content");

    function resizeContent() {
      if (!panel || !content) return;
      const panelRect = panel.getBoundingClientRect();
      const contentRect = content.getBoundingClientRect();
      const footer = document.getElementById("group-editor-footer");
      const footerRect = footer ? footer.getBoundingClientRect() : { height: 0 };

      // Calculate available height: panel height - everything above content - footer height
      const availableHeight =
        panelRect.height - (contentRect.top - panelRect.top) - footerRect.height;

      if (availableHeight > 0) {
        content.style.height = `${availableHeight}px`;
      }
    }

    // Set up resize observer
    const resizeObserver = new ResizeObserver(() => {
      resizeContent();
    });

    resizeObserver.observe(panel);

    // Initial resize after a short delay to ensure footer is rendered
    setTimeout(resizeContent, 100);
  });
</script>

      <!-- Node Editor Panel with Tabs -->
<div
  class="panel panel-overlay panel-editor fixed bottom-10 left-20 overflow-hidden z-[21] draggable-panel flex flex-col"
  id="panel-node-editor"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="panel-node-editor-heading">
    <span class="panel-title">Node Editor</span>
    <button class="panel-close-btn" id="panel-node-editor-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Tab Navigation (Scrollable with Arrow Buttons) -->
  <div class="panel-tabs panel-tabs--with-arrows">
    <button
      class="tab-scroll-btn"
      id="node-editor-tab-scroll-left"
      aria-label="Scroll tabs left"
      title="Scroll left"
    >
      <i class="fas fa-chevron-left"></i>
    </button>
    <div class="tab-scroll-viewport" id="node-editor-tab-viewport">
      <div class="tab-strip" id="node-editor-tab-strip">
        <button class="panel-tab-button tab-active" data-tab="basic">Basic</button>
        <button class="panel-tab-button hidden" data-tab="components" id="tab-components-button">
          Components
        </button>
        <button class="panel-tab-button" data-tab="config">Configuration</button>
        <button class="panel-tab-button" data-tab="runtime">Runtime</button>
        <button class="panel-tab-button" data-tab="network">Network</button>
        <button class="panel-tab-button" data-tab="advanced">Advanced</button>
      </div>
    </div>
    <button
      class="tab-scroll-btn"
      id="node-editor-tab-scroll-right"
      aria-label="Scroll tabs right"
      title="Scroll right"
    >
      <i class="fas fa-chevron-right"></i>
    </button>
  </div>

  <!-- Tab Content Container -->
  <div class="panel-block p-2 overflow-y-auto" id="node-editor-tab-container">
    <!-- Basic Tab -->
    <div class="tab-content" id="tab-basic">
      <div class="space-y-3">
        <!-- Node Name -->
        <div class="form-group" id="node-name-group">
          <label class="block vscode-label mb-1">Node Name</label>
          <input type="text" id="node-name" class="input-field w-full" />
        </div>

        <!-- Custom Node Name -->
        <div class="form-group" id="node-custom-name-group">
          <label class="block vscode-label mb-1">Custom Node Name</label>
          <input
            type="text"
            id="node-custom-name"
            class="input-field w-full"
            placeholder="Template name"
          />
          <label class="block vscode-label mb-1 mt-2">Base Name (for canvas)</label>
          <input
            type="text"
            id="node-base-name"
            class="input-field w-full"
            placeholder="e.g., srl (will become srl1, srl2, etc.)"
          />
          <div class="flex items-center mt-2">
            <input type="checkbox" id="node-custom-default" class="vscode-checkbox mr-2" />
            <label for="node-custom-default" class="checkbox-label">Set as default</label>
          </div>
          <label class="block vscode-label mb-1 mt-2">
            Interface Pattern
            <span class="relative inline-flex items-center ml-1">
              <button
                type="button"
                class="peer inline-flex items-center justify-center text-[var(--text-secondary)] transition-colors duration-150 hover:text-[var(--text-primary)] focus-visible:text-[var(--text-primary)] focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-[var(--vscode-focusBorder)]"
                aria-label="Interface pattern help"
                aria-describedby="interface-pattern-help-tooltip"
              >
                <i class="fas fa-info-circle" aria-hidden="true"></i>
              </button>
              <span
                role="tooltip"
                id="interface-pattern-help-tooltip"
                class="pointer-events-none absolute left-1/2 top-full z-10 mt-2 w-fit -translate-x-1/2 translate-y-1 rounded-md border border-[var(--vscode-editorHoverWidget-border)] bg-[var(--vscode-editorHoverWidget-background)] px-3 py-2 text-left text-sm leading-relaxed text-[var(--vscode-editorHoverWidget-foreground)] shadow-lg opacity-0 transition duration-150 ease-out peer-hover:translate-y-0 peer-hover:opacity-100 peer-focus:translate-y-0 peer-focus:opacity-100 peer-focus-visible:translate-y-0 peer-focus-visible:opacity-100"
                style="max-width: min(24rem, calc(100vw - 3rem))"
              >
                <span class="pointer-events-none absolute inset-x-0 -top-2 flex justify-center">
                  <span
                    class="h-3 w-3 rotate-45 border border-[var(--vscode-editorHoverWidget-border)] bg-[var(--vscode-editorHoverWidget-background)] shadow-lg"
                  ></span>
                </span>
                <div class="relative z-10">
                  <span class="block font-semibold">Interface pattern tips</span>
                  <span class="block mt-1">
                    Use
                    <code class="whitespace-nowrap">{n}</code>
                    placeholders to expand sequential interface names:
                  </span>
                  <ul class="mt-2 space-y-1 list-disc pl-4">
                    <li>
                      <code class="whitespace-nowrap">xe-{n}</code>
                      &rarr; xe-1, xe-2, xe-3 â¦
                    </li>
                    <li>
                      <code class="whitespace-nowrap">xe-{n:0}</code>
                      starts numbering at 0.
                    </li>
                    <li>
                      <code class="whitespace-nowrap">xe-{n:1-4}</code>
                      caps numbering between 1 and 4.
                    </li>
                    <li>
                      <code class="whitespace-nowrap">e1-{n:1-2}, e2-{n:1-2}</code>
                      generates multiple blocks (e1-1, e1-2, e2-1, e2-2).
                    </li>
                  </ul>
                </div>
              </span>
            </span>
          </label>
          <input
            type="text"
            id="node-interface-pattern"
            class="input-field w-full"
            placeholder="e.g., e1-{n} or Gi0/0/{n:0}"
          />
        </div>

        <!-- Kind -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Kind</label>
          <div id="node-kind-dropdown-container"></div>
        </div>

        <!-- Type -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Type</label>
          <div id="panel-node-type-dropdown-container" style="display: none"></div>
          <input
            type="text"
            id="node-type"
            class="input-field w-full"
            placeholder="e.g., ixr-d2l, ixr-d2l"
            style="display: block"
          />
          <div
            id="node-type-warning"
            class="text-xs mt-1"
            style="display: none; color: var(--vscode-editorWarning-foreground, #e0af25)"
          ></div>
        </div>

        <!-- Image and Version in same row -->
        <div class="grid grid-cols-2 gap-2">
          <div class="form-group">
            <label class="block vscode-label mb-1">Image</label>
            <div id="node-image-dropdown-container"></div>
          </div>
          <div class="form-group">
            <label class="block vscode-label mb-1">Version</label>
            <div id="node-version-dropdown-container"></div>
          </div>
        </div>

        <!-- Icon -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Icon</label>
          <div class="flex gap-2 items-start">
            <div class="flex-1" id="panel-node-topoviewerrole-dropdown-container"></div>
            <button
              type="button"
              class="btn btn-small whitespace-nowrap"
              id="node-icon-edit-button"
              title="Edit icon color and shape"
            >
              <i class="fas fa-pen mr-1"></i>
              Edit
            </button>
            <button
              type="button"
              class="btn btn-small whitespace-nowrap"
              id="node-icon-add-button"
              title="Add a custom icon"
            >
              <i class="fas fa-plus mr-1"></i>
              Add
            </button>
          </div>
          <input type="hidden" id="node-icon-color" value="" />
        </div>
      </div>
    </div>

    <!-- Components Tab -->
    <div class="tab-content hidden" id="tab-components">
      <div class="space-y-3">
        <div class="space-y-4">
          <div class="flex flex-wrap gap-2" id="node-components-actions-distributed">
            <button
              type="button"
              class="btn btn-small"
              id="btn-add-cpm"
              onclick="addCpmComponentEntry()"
            >
              <i class="fas fa-plus mr-1"></i>
              Add CPM
            </button>
            <button
              type="button"
              class="btn btn-small"
              id="btn-add-card"
              onclick="addCardComponentEntry()"
            >
              <i class="fas fa-plus mr-1"></i>
              Add Card
            </button>
          </div>
          <div class="flex flex-wrap gap-2 hidden" id="node-components-actions-integrated">
            <button
              type="button"
              class="btn btn-small"
              id="btn-add-integrated-mda"
              onclick="addIntegratedMdaEntry()"
            >
              <i class="fas fa-plus mr-1"></i>
              Add MDA
            </button>
          </div>
          <div id="node-components-integrated-section" class="space-y-3 hidden">
            <div>
              <p class="vscode-label mb-1">MDA</p>
              <p class="text-xs text-[var(--text-secondary)]">
                Configure MDAs for integrated chassis directly.
              </p>
              <div id="node-integrated-mda-container" class="mt-2 space-y-3"></div>
            </div>
          </div>
          <div id="node-components-container" class="space-y-4">
            <div id="node-components-section-cpm">
              <p class="vscode-label mb-1">CPM</p>
              <p class="text-xs text-[var(--text-secondary)]">
                Slots A and B represent the chassis control processors.
              </p>
              <div id="node-components-cpm-container" class="mt-2 space-y-3">
                <!-- CPM entries go here dynamically -->
              </div>
            </div>
            <div id="node-components-section-cards">
              <p class="vscode-label mb-1">Line Cards</p>
              <p class="text-xs text-[var(--text-secondary)]">
                Define card slots and attach IOM/XCM, MDA, and XIOM components.
              </p>
              <div id="node-components-card-container" class="mt-2 space-y-3">
                <!-- Line card entries go here dynamically -->
              </div>
            </div>
            <div id="node-components-section-sfm">
              <p class="vscode-label mb-1">SFM</p>
              <p class="text-xs text-[var(--text-secondary)]">
                Overrides the default SFM when set.
              </p>
              <div id="node-components-sfm-container" class="space-y-3 mt-1"></div>
            </div>
            <div
              id="node-components-validation-anchor"
              class="border border-transparent rounded-md"
            ></div>
          </div>
        </div>

        <template id="tpl-component-entry">
          <div class="component-entry my-2 p-2 rounded-lg bg-[var(--bg-primary)]" data-idx>
            <!-- Accordion Header -->
            <div
              class="component-header flex items-center justify-between cursor-pointer select-none bg-bg-primary"
              data-action="toggle-component"
            >
              <div class="flex items-center gap-2">
                <i class="fas text-sm fa-chevron-right" data-role="component-caret"></i>
                <label class="vscode-label">Slot</label>
                <input
                  type="text"
                  class="px-2 py-1 w-10 bg-transparent border-b border-[var(--vscode-input-border)] outline-none outline-offset-0 ring-0 shadow-none focus:outline-none focus-visible:outline-none focus:outline-offset-0 focus:ring-0 focus-visible:ring-0 focus:shadow-none focus-visible:shadow-none focus:border-[var(--vscode-input-border)]"
                  data-role="component-slot"
                />
              </div>
              <button
                type="button"
                class="dynamic-delete-btn"
                data-action="remove-component"
                aria-label="Remove component"
              >
                <i class="fas fa-trash"></i>
              </button>
            </div>

            <!-- Body -->
            <div class="component-body mt-2 hidden" data-role="component-body">
              <div class="grid grid-flow-row gap-2">
                <div class="form-group">
                  <label class="block vscode-label component-section-label">Type</label>
                  <input type="hidden" data-role="component-type-value" />
                  <div data-role="component-type-dropdown"></div>
                </div>
              </div>

              <!-- XIOM list -->
              <div class="form-group mt-2">
                <label class="block vscode-label component-section-label">XIOM</label>
                <div data-role="xiom-list" class="space-y-2"></div>
                <button
                  type="button"
                  class="btn btn-small mt-2 add-xiom-btn"
                  data-action="add-xiom"
                >
                  <i class="fas fa-plus mr-1"></i>
                  Add XIOM
                </button>
              </div>

              <div class="form-group mt-2" data-role="component-mda-group">
                <label class="block vscode-label component-section-label">MDA</label>
                <div data-role="mda-list" class="space-y-2"></div>
                <button type="button" class="btn btn-small mt-2" data-action="add-mda">
                  <i class="fas fa-plus mr-1"></i>
                  Add MDA
                </button>
              </div>
            </div>
          </div>
        </template>

        <template id="tpl-sfm-entry">
          <div class="component-sfm-entry my-2 p-2 rounded-lg bg-[var(--bg-primary)]">
            <div class="flex items-start justify-between gap-3">
              <div class="flex-1">
                <label class="block vscode-label mb-1">SFM Type</label>
                <input type="hidden" data-role="sfm-value" />
                <div data-role="sfm-dropdown"></div>
              </div>
            </div>
          </div>
        </template>

        <!-- XIOM entry template -->
        <template id="tpl-xiom-entry">
          <div class="component-xiom-entry">
            <!-- Labels for xiom -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <label class="block vscode-label mb-1 w-full h-full">XIOM Slot</label>
              </div>
              <div class="col-span-7 pl-3">
                <label class="block vscode-label mb-1 w-full h-full">XIOM Type</label>
              </div>
              <div class="col-span-1 w-full h-full"></div>
            </div>

            <!-- xiom input vals + delete btn -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <div class="slot-field-shell">
                  <span class="slot-badge" data-role="xiom-card-slot">-</span>
                  <input type="hidden" data-role="xiom-slot-value" />
                  <div class="slot-dropdown flex-1 min-w-0">
                    <div data-role="xiom-slot-dropdown" class="w-full h-full"></div>
                  </div>
                </div>
              </div>
              <div class="col-span-7 pl-3">
                <input type="hidden" data-role="xiom-type-value" />
                <div data-role="xiom-type-dropdown" class="w-full h-full"></div>
              </div>
              <div class="col-span-1 flex items-center justify-end">
                <button
                  type="button"
                  class="dynamic-delete-btn"
                  data-action="remove-xiom"
                  aria-label="Remove XIOM"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>

            <!-- XIOM-scoped MDA list -->
            <div class="form-group mt-2 xiom-mda-section">
              <label class="block vscode-label mb-1">MDA (under XIOM)</label>
              <div data-role="xiom-mda-list" class="space-y-2"></div>
              <button type="button" class="btn btn-small mt-2" data-action="add-xiom-mda">
                <i class="fas fa-plus mr-1"></i>
                Add MDA
              </button>
            </div>
          </div>
        </template>

        <!-- XIOM MDA entry template -->
        <template id="tpl-xiom-mda-entry">
          <div class="component-xiom-mda-entry">
            <!-- Labels for xiom mda -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <label class="block vscode-label mb-1 w-full h-full">Slot</label>
              </div>
              <div class="col-span-7 pl-5">
                <label class="block vscode-label mb-1 w-full h-full">Type</label>
              </div>
              <div class="col-span-1 w-full h-full"></div>
            </div>

            <!-- xiom mda input vals + delete btn -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <div class="slot-field-shell">
                  <span class="slot-badge" data-role="xiom-mda-card-slot">-</span>
                  <input
                    type="number"
                    min="1"
                    step="1"
                    class="slot-number-input"
                    data-role="xiom-mda-slot"
                  />
                </div>
              </div>
              <div class="col-span-7 pl-5">
                <input type="hidden" data-role="xiom-mda-type-value" />
                <div data-role="xiom-mda-type-dropdown" class="w-full h-full"></div>
              </div>
              <div class="col-span-1 flex items-center justify-end">
                <button
                  type="button"
                  class="dynamic-delete-btn"
                  data-action="remove-xiom-mda"
                  aria-label="Remove MDA"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </template>
        <template id="tpl-mda-entry">
          <div class="component-mda-entry">
            <!-- Labels for mda -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <label class="block vscode-label mb-1 w-full h-full">Slot</label>
              </div>
              <div class="col-span-7 pl-3">
                <label class="block vscode-label mb-1 w-full h-full">Type</label>
              </div>
              <div class="col-span-1 w-full h-full"></div>
            </div>

            <!-- mda input vals + delete btn -->
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <div class="slot-field-shell">
                  <span class="slot-badge" data-role="mda-card-slot">-</span>
                  <input
                    type="number"
                    min="1"
                    step="1"
                    class="slot-number-input"
                    data-role="mda-slot"
                  />
                </div>
              </div>
              <div class="col-span-7 pl-3">
                <input type="hidden" data-role="mda-type-value" />
                <div data-role="mda-type-dropdown" class="w-full h-full"></div>
              </div>
              <div class="col-span-1 flex items-center justify-end">
                <button
                  type="button"
                  class="dynamic-delete-btn"
                  data-action="remove-mda"
                  aria-label="Remove MDA"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </template>
        <template id="tpl-integrated-mda-entry">
          <div class="integrated-mda-entry">
            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <label class="block vscode-label mb-1 w-full h-full">Slot</label>
              </div>
              <div class="col-span-7 pl-3">
                <label class="block vscode-label mb-1 w-full h-full">Type</label>
              </div>
              <div class="col-span-1 w-full h-full"></div>
            </div>

            <div class="grid grid-cols-10 gap-x-4 gap-y-2 items-stretch">
              <div class="col-span-2">
                <div class="slot-field-shell">
                  <input
                    type="number"
                    min="1"
                    step="1"
                    class="slot-number-input"
                    data-role="integrated-mda-slot"
                  />
                </div>
              </div>
              <div class="col-span-7 pl-3">
                <input type="hidden" data-role="integrated-mda-type-value" />
                <div data-role="integrated-mda-type-dropdown" class="w-full h-full"></div>
              </div>
              <div class="col-span-1 flex items-center justify-end">
                <button
                  type="button"
                  class="dynamic-delete-btn"
                  data-action="remove-integrated-mda"
                  aria-label="Remove MDA"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </div>
          </div>
        </template>
      </div>
    </div>

    <!-- Configuration Tab -->
    <div class="tab-content hidden" id="tab-config">
      <div class="space-y-3">
        <!-- Startup Config -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Startup Config</label>
          <input
            type="text"
            id="node-startup-config"
            class="input-field w-full"
            placeholder="Path to config file"
          />
          <div class="flex items-center mt-1">
            <input type="checkbox" id="node-enforce-startup-config" class="vscode-checkbox mr-2" />
            <label for="node-enforce-startup-config" class="checkbox-label">
              Enforce startup config
            </label>
          </div>
          <div class="flex items-center mt-1">
            <input type="checkbox" id="node-suppress-startup-config" class="vscode-checkbox mr-2" />
            <label for="node-suppress-startup-config" class="checkbox-label">
              Suppress startup config
            </label>
          </div>
        </div>

        <!-- License -->
        <div class="form-group">
          <label class="block vscode-label mb-1">License File</label>
          <input
            type="text"
            id="node-license"
            class="input-field w-full"
            placeholder="Path to license file"
          />
        </div>

        <!-- Binds -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Bind Mounts</label>
          <div id="node-binds-container" class="space-y-2">
            <!-- Dynamic bind entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addBindEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Bind
          </button>
        </div>

        <!-- Environment Variables -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Environment Variables</label>
          <div id="node-env-container" class="space-y-2">
            <!-- Dynamic env entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addEnvEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Variable
          </button>
        </div>

        <!-- Environment Files -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Environment Files</label>
          <div id="node-env-files-container" class="space-y-2">
            <!-- Dynamic env file entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addEnvFileEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Env File
          </button>
        </div>

        <!-- Labels -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Labels</label>
          <div id="node-labels-container" class="space-y-2">
            <!-- Dynamic label entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addLabelEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Label
          </button>
        </div>
      </div>
    </div>

    <!-- Runtime Tab -->
    <div class="tab-content hidden" id="tab-runtime">
      <div class="space-y-3">
        <!-- User -->
        <div class="form-group">
          <label class="block vscode-label mb-1">User</label>
          <input
            type="text"
            id="node-user"
            class="input-field w-full"
            placeholder="Container user"
          />
        </div>

        <!-- Entrypoint -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Entrypoint</label>
          <input
            type="text"
            id="node-entrypoint"
            class="input-field w-full"
            placeholder="Container entrypoint"
          />
        </div>

        <!-- CMD -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Command</label>
          <input
            type="text"
            id="node-cmd"
            class="input-field w-full"
            placeholder="Container command"
          />
        </div>

        <!-- Exec Commands -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Exec Commands</label>
          <div id="node-exec-container" class="space-y-2">
            <!-- Dynamic exec entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addExecEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Command
          </button>
        </div>

        <!-- Restart Policy -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Restart Policy</label>
          <div id="node-restart-policy-dropdown-container"></div>
        </div>

        <!-- Auto Remove -->
        <div class="form-group">
          <div class="flex items-center">
            <input type="checkbox" id="node-auto-remove" class="vscode-checkbox mr-2" />
            <label for="node-auto-remove" class="checkbox-label">
              Auto-remove container on exit
            </label>
          </div>
        </div>

        <!-- Startup Delay -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Startup Delay (seconds)</label>
          <input
            type="number"
            id="node-startup-delay"
            class="input-field w-full"
            min="0"
            placeholder="0"
          />
        </div>
      </div>
    </div>

    <!-- Network Tab -->
    <div class="tab-content hidden" id="tab-network">
      <div class="space-y-3">
        <!-- Management IPv4 -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Management IPv4</label>
          <input
            type="text"
            id="node-mgmt-ipv4"
            class="input-field w-full"
            placeholder="e.g., 172.20.20.100"
          />
        </div>

        <!-- Management IPv6 -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Management IPv6</label>
          <input
            type="text"
            id="node-mgmt-ipv6"
            class="input-field w-full"
            placeholder="e.g., 2001:db8::100"
          />
        </div>

        <!-- Network Mode -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Network Mode</label>
          <div id="node-network-mode-dropdown-container"></div>
        </div>

        <!-- Ports -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Port Mappings</label>
          <div id="node-ports-container" class="space-y-2">
            <!-- Dynamic port entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addPortEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Port
          </button>
        </div>

        <!-- DNS Configuration -->
        <div class="form-group">
          <label class="block vscode-label mb-1">DNS Servers</label>
          <div id="node-dns-servers-container" class="space-y-2">
            <!-- Dynamic DNS server entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addDnsServerEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add DNS Server
          </button>
        </div>

        <!-- Aliases -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Network Aliases</label>
          <div id="node-aliases-container" class="space-y-2">
            <!-- Dynamic alias entries will be added here -->
          </div>
          <button class="btn btn-small mt-2" onclick="addAliasEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Alias
          </button>
        </div>
      </div>
    </div>

    <!-- Advanced Tab -->
    <div class="tab-content hidden" id="tab-advanced">
      <div class="space-y-3">
        <!-- Resources Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">Resource Limits</h3>
          <div class="grid grid-cols-2 gap-2">
            <!-- CPU -->
            <div class="form-group">
              <label class="block vscode-label mb-1">CPU Limit</label>
              <input
                type="number"
                id="node-cpu"
                class="input-field w-full"
                step="0.1"
                min="0"
                placeholder="e.g., 1.5"
              />
            </div>

            <!-- CPU Set -->
            <div class="form-group">
              <label class="block vscode-label mb-1">CPU Set</label>
              <input
                type="text"
                id="node-cpu-set"
                class="input-field w-full"
                placeholder="e.g., 0-3, 0,3"
              />
            </div>
            <!-- Memory -->
            <div class="form-group">
              <label class="block vscode-label mb-1">Memory Limit</label>
              <input
                type="text"
                id="node-memory"
                class="input-field w-full"
                placeholder="e.g., 1Gb, 512Mb"
              />
            </div>

            <!-- Shared Memory Size -->
            <div class="form-group">
              <label class="block vscode-label mb-1">Shared Memory Size</label>
              <input
                type="text"
                id="node-shm-size"
                class="input-field w-full"
                placeholder="e.g., 256MB"
              />
            </div>
          </div>
        </div>

        <!-- Capabilities Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">Capabilities</h3>

          <!-- Cap Add -->
          <div class="form-group">
            <label class="block vscode-label mb-1">Add Capabilities</label>
            <div id="node-cap-add-container" class="space-y-2">
              <!-- Dynamic capability entries will be added here -->
            </div>
            <button class="btn btn-small mt-2" onclick="addCapabilityEntry()">
              <i class="fas fa-plus mr-1"></i>
              Add Capability
            </button>
          </div>
        </div>

        <!-- Sysctls Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">Sysctls</h3>

          <div class="form-group">
            <div id="node-sysctls-container" class="space-y-2">
              <!-- Dynamic sysctl entries will be added here -->
            </div>
            <button class="btn btn-small mt-2" onclick="addSysctlEntry()">
              <i class="fas fa-plus mr-1"></i>
              Add Sysctl
            </button>
          </div>
        </div>

        <!-- Devices Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">Devices</h3>

          <div class="form-group">
            <div id="node-devices-container" class="space-y-2">
              <!-- Dynamic device entries will be added here -->
            </div>
            <button class="btn btn-small mt-2" onclick="addDeviceEntry()">
              <i class="fas fa-plus mr-1"></i>
              Add Device
            </button>
          </div>
        </div>

        <!-- Certificate Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">TLS Certificate</h3>

          <div class="form-group">
            <div class="flex items-center">
              <input type="checkbox" id="node-cert-issue" class="vscode-checkbox mr-2" />
              <label for="node-cert-issue" class="checkbox-label">
                Auto-generate TLS certificate
              </label>
            </div>
          </div>

          <div id="cert-options" class="mt-2 hidden">
            <div class="form-group">
              <label class="block vscode-label mb-1">Key Size</label>
              <div id="node-cert-key-size-dropdown-container"></div>
            </div>

            <div class="form-group">
              <label class="block vscode-label mb-1">Validity Duration</label>
              <input
                type="text"
                id="node-cert-validity"
                class="input-field w-full"
                placeholder="e.g., 1h, 30d, 1y"
              />
            </div>

            <div class="form-group">
              <label class="block vscode-label mb-1">SANs (Subject Alternative Names)</label>
              <div id="node-sans-container" class="space-y-2">
                <!-- Dynamic SAN entries will be added here -->
              </div>
              <button class="btn btn-small mt-2" onclick="addSanEntry()">
                <i class="fas fa-plus mr-1"></i>
                Add SAN
              </button>
            </div>
          </div>
        </div>

        <!-- Healthcheck Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <h3 class="vscode-section-header mb-2">Health Check</h3>

          <div class="form-group">
            <label class="block vscode-label mb-1">Test Command</label>
            <input
              type="text"
              id="node-healthcheck-test"
              class="input-field w-full"
              placeholder="e.g., CMD-SHELL cat /etc/os-release"
            />
          </div>

          <div class="grid grid-cols-2 gap-2">
            <div class="form-group">
              <label class="block vscode-label mb-1">Start Period (s)</label>
              <input
                type="number"
                id="node-healthcheck-start-period"
                class="input-field w-full"
                min="0"
                placeholder="0"
              />
            </div>
            <div class="form-group">
              <label class="block vscode-label mb-1">Interval (s)</label>
              <input
                type="number"
                id="node-healthcheck-interval"
                class="input-field w-full"
                min="0"
                placeholder="30"
              />
            </div>
            <div class="form-group">
              <label class="block vscode-label mb-1">Timeout (s)</label>
              <input
                type="number"
                id="node-healthcheck-timeout"
                class="input-field w-full"
                min="0"
                placeholder="30"
              />
            </div>
            <div class="form-group">
              <label class="block vscode-label mb-1">Retries</label>
              <input
                type="number"
                id="node-healthcheck-retries"
                class="input-field w-full"
                min="0"
                placeholder="3"
              />
            </div>
          </div>
        </div>

        <!-- Image Pull Policy -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Image Pull Policy</label>
          <div id="node-image-pull-policy-dropdown-container"></div>
        </div>

        <!-- Runtime -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Container Runtime</label>
          <div id="node-runtime-dropdown-container"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="panel-node-footer-placeholder" class="flex-shrink-0"></div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const panel = document.getElementById("panel-node-editor");
      const tabContainer = document.getElementById("node-editor-tab-container");

      const footerTpl = document.getElementById("editor-footer-template");
      if (footerTpl) {
        const footerFrag = footerTpl.content.cloneNode(true);
        const applyBtn = footerFrag.querySelector(".editor-apply-btn");
        const okBtn = footerFrag.querySelector(".editor-save-btn");
        if (applyBtn) {
          applyBtn.id = "panel-node-editor-apply";
        }
        if (okBtn) {
          okBtn.id = "panel-node-editor-save";
        }
        document.getElementById("panel-node-footer-placeholder")?.appendChild(footerFrag);
      }

      // Resize observer to calculate tab container height
      function resizeTabContainer() {
        if (!panel || !tabContainer) return;
        const panelRect = panel.getBoundingClientRect();
        const tabContainerRect = tabContainer.getBoundingClientRect();
        const footer = document.getElementById("panel-node-footer-placeholder");
        const footerRect = footer ? footer.getBoundingClientRect() : { height: 0 };

        // Calculate available height
        const availableHeight =
          panelRect.height - (tabContainerRect.top - panelRect.top) - footerRect.height;

        if (availableHeight > 0) {
          tabContainer.style.height = `${availableHeight}px`;
        }
      }

      // Set up resize observer
      const resizeObserver = new ResizeObserver(() => {
        resizeTabContainer();
      });

      resizeObserver.observe(panel);

      // Initial resize
      setTimeout(resizeTabContainer, 100);
    });
  </script>
</div>

<div id="node-icon-editor-backdrop" class="modal-backdrop" style="display: none"></div>
<div id="node-icon-editor-modal" class="modal-content max-w-md" style="display: none">
  <div class="panel-block p-6 space-y-4">
    <div class="flex items-center justify-between">
      <h3 class="text-lg font-semibold text-[var(--text-primary)]">Edit Icon</h3>
      <button
        type="button"
        class="btn-icon-hover-clean text-[var(--text-secondary)]"
        id="node-icon-editor-close"
        aria-label="Close icon editor"
      >
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="space-y-4">
      <div class="form-group">
        <label class="block vscode-label mb-1">Color</label>
        <div class="flex items-center gap-2">
          <input
            type="color"
            class="input-field h-10 w-14 cursor-pointer border border-gray-500"
            id="node-icon-editor-color"
            value="#005aff"
          />
          <input
            type="text"
            class="input-field flex-1"
            id="node-icon-editor-hex"
            placeholder="#005aff"
            maxlength="7"
          />
        </div>
      </div>
      <div class="form-group">
        <label class="block vscode-label mb-1">Icon</label>
        <select class="input-field w-full" id="node-icon-editor-shape"></select>
      </div>
      <div class="form-group">
        <label class="block vscode-label mb-1">Corner Radius</label>
        <div class="flex items-center gap-2">
          <input
            type="range"
            min="0"
            max="40"
            value="0"
            id="node-icon-editor-corner"
            class="flex-1"
          />
          <span class="text-sm w-14 text-right" id="node-icon-editor-corner-value">0px</span>
        </div>
      </div>
      <div class="form-group">
        <label class="block vscode-label mb-1">Preview</label>
        <div class="flex items-center gap-4">
          <img
            id="node-icon-editor-preview"
            class="w-16 h-16 rounded border border-[var(--vscode-panel-border)] bg-[var(--vscode-editor-background)] object-contain"
            src=""
            alt="Icon preview"
          />
          <span class="text-sm text-[var(--text-secondary)]">
            Updates as you change color or shape
          </span>
        </div>
      </div>
    </div>
    <div class="flex justify-end gap-2 pt-2">
      <button type="button" class="btn btn-secondary btn-small" id="node-icon-editor-cancel">
        Cancel
      </button>
      <button type="button" class="btn btn-primary btn-small" id="node-icon-editor-save">
        Apply
      </button>
    </div>
  </div>
</div>

      <!-- Network Editor Panel -->
<div
  class="panel panel-overlay panel-editor fixed bottom-10 left-20 overflow-hidden z-[21] draggable-panel flex flex-col"
  id="panel-network-editor"
  style="display: none"
>
  <div class="panel-heading panel-title-bar">
    <span class="panel-title">Network Editor</span>
    <button
      class="panel-close-btn"
      id="panel-network-editor-close"
      aria-label="Close"
      title="Close"
    >
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="panel-block p-2 overflow-y-auto" id="network-editor-content">
    <div class="space-y-3">
      <!-- Basic Information Section -->
      <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
        <!-- Network Name -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Network Name</label>
          <div>
            <span
              id="panel-network-editor-id"
              class="text-base px-2 py-1 inline-block rounded"
              style="
                background-color: var(--vscode-textBlockQuote-background);
                border: 1px solid var(--vscode-textBlockQuote-border);
              "
            ></span>
          </div>
        </div>

        <!-- Network Type -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Network Type</label>
          <div id="panel-network-type-dropdown-container">
            <!-- Filterable dropdown will be inserted here -->
          </div>
        </div>

        <!-- Interface / Bridge Name -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Interface</label>
          <input type="text" class="input-field w-full" id="panel-network-interface" />
        </div>

        <!-- Bridge Alias Label (at the moment only for BRIDGE/OVS-BRIDGE) -->
        <div class="form-group" style="display: none">
          <label class="block vscode-label mb-1">Alias Label</label>
          <input
            type="text"
            class="input-field w-full"
            id="panel-network-label"
            placeholder="Display label (e.g., bridge-a)"
          />
        </div>

        <!-- Validation Errors -->
        <div
          id="panel-network-validation-errors"
          class="p-2 rounded bg-[var(--vscode-inputValidation-errorBackground)] border border-[var(--vscode-inputValidation-errorBorder)]"
          style="display: none"
        >
          <div class="text-[var(--vscode-editorError-foreground)] text-sm font-semibold">
            Please fix the following errors:
          </div>
          <ul
            id="panel-network-validation-errors-list"
            class="text-[var(--vscode-editorError-foreground)] text-xs mt-1 list-disc list-inside"
          ></ul>
        </div>
      </div>
      <!-- Extended Properties Section -->
      <div class="vscode-section-header mb-2">Extended Properties</div>

      <!-- MAC Address (for single endpoint connections) -->
      <div class="form-group" id="panel-network-mac-section">
        <label class="block vscode-label mb-1">MAC Address</label>
        <input
          type="text"
          class="input-field w-full"
          id="panel-network-mac"
          placeholder="e.g., 02:42:ac:11:00:01"
        />
      </div>

      <!-- MTU (all types) -->
      <div class="form-group">
        <label class="block vscode-label mb-1">MTU</label>
        <input type="number" class="input-field w-full" id="panel-network-mtu" placeholder="1500" />
      </div>

      <!-- Macvlan Mode (only for macvlan) -->
      <div class="form-group" id="panel-network-mode-section" style="display: none">
        <label class="block vscode-label mb-1">Mode</label>
        <select class="input-field w-full" id="panel-network-mode">
          <option value="bridge">bridge (default)</option>
          <option value="private">private</option>
          <option value="vepa">vepa</option>
          <option value="passthru">passthru</option>
          <option value="source">source</option>
        </select>
      </div>

      <!-- VXLAN fields (only for vxlan/vxlan-stitch) -->
      <div id="panel-network-vxlan-section" style="display: none">
        <div class="form-group">
          <label class="block vscode-label mb-1">
            Remote IP
            <span class="text-[var(--vscode-editorError-foreground)]">*</span>
          </label>
          <input
            type="text"
            class="input-field w-full"
            id="panel-network-remote"
            placeholder="10.0.0.1"
          />
        </div>
        <div class="form-group">
          <label class="block vscode-label mb-1">
            VNI
            <span class="text-[var(--vscode-editorError-foreground)]">*</span>
          </label>
          <input
            type="number"
            class="input-field w-full"
            id="panel-network-vni"
            placeholder="100"
          />
        </div>
        <div class="form-group">
          <label class="block vscode-label mb-1">
            Destination Port
            <span class="text-[var(--vscode-editorError-foreground)]">*</span>
          </label>
          <input
            type="number"
            class="input-field w-full"
            id="panel-network-dst-port"
            placeholder="4789"
          />
        </div>
        <div class="form-group">
          <label class="block vscode-label mb-1">Source Port</label>
          <input
            type="number"
            class="input-field w-full"
            id="panel-network-src-port"
            placeholder=""
          />
        </div>
      </div>

      <div id="panel-network-vars-placeholder"></div>

      <!-- Labels -->
      <div class="form-group">
        <label class="block vscode-label mb-1">Labels</label>
        <div id="panel-network-labels-container" class="space-y-2">
          <!-- Dynamic label entries will be added here -->
        </div>
        <button class="btn btn-small mt-2" onclick="addNetworkLabelEntry()">
          <i class="fas fa-plus mr-1"></i>
          Add Label
        </button>
      </div>
    </div>
  </div>
  <div id="panel-network-footer-placeholder" class="flex-shrink-0"></div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const varsTpl = document.getElementById("vars-section-template");
      const footerTpl = document.getElementById("editor-footer-template");
      if (varsTpl && footerTpl) {
        const varsFrag = varsTpl.content.cloneNode(true);
        const varsContainer = varsFrag.querySelector(".vars-container");
        const addBtn = varsFrag.querySelector(".add-var-btn");
        if (varsContainer) {
          varsContainer.id = "panel-network-vars-container";
        }
        if (addBtn) {
          addBtn.setAttribute("onclick", "addNetworkVarEntry()");
        }
        document.getElementById("panel-network-vars-placeholder")?.appendChild(varsFrag);

        const footerFrag = footerTpl.content.cloneNode(true);
        const saveBtn = footerFrag.querySelector(".editor-save-btn");
        const applyBtn = footerFrag.querySelector(".editor-apply-btn");
        if (saveBtn) {
          saveBtn.id = "panel-network-editor-save-button";
        }
        if (applyBtn) {
          applyBtn.id = "panel-network-editor-apply-button";
        }
        document.getElementById("panel-network-footer-placeholder")?.appendChild(footerFrag);
      }

      // Resize observer to calculate content height
      const panel = document.getElementById("panel-network-editor");
      const content = document.getElementById("network-editor-content");

      function resizeContent() {
        if (!panel || !content) return;
        const panelRect = panel.getBoundingClientRect();
        const contentRect = content.getBoundingClientRect();
        const footer = document.getElementById("panel-network-footer-placeholder");
        const footerRect = footer ? footer.getBoundingClientRect() : { height: 0 };

        // Calculate available height: panel height - everything above content - footer height
        const availableHeight =
          panelRect.height - (contentRect.top - panelRect.top) - footerRect.height;

        if (availableHeight > 0) {
          content.style.height = `${availableHeight}px`;
        }
      }

      // Set up resize observer
      const resizeObserver = new ResizeObserver(() => {
        resizeContent();
      });

      resizeObserver.observe(panel);

      // Initial resize after a short delay to ensure footer is rendered
      setTimeout(resizeContent, 100);
    });
  </script>
</div>

      <!-- Lab Settings Panel with Tabs -->
<div
  class="panel panel-overlay panel-editor fixed bottom-10 left-20 overflow-hidden z-[21] draggable-panel flex flex-col"
  id="panel-lab-settings"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="panel-lab-settings-heading">
    <span class="panel-title">Lab Settings</span>
    <button class="panel-close-btn" id="panel-lab-settings-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="panel-tabs" style="justify-content: flex-start">
    <button class="panel-tab-button tab-active" data-tab="basic-lab">Basic</button>
    <button class="panel-tab-button" data-tab="mgmt">Management</button>
  </div>

  <!-- Tab Content Container -->
  <div class="panel-block p-2 overflow-y-auto" id="lab-settings-tab-container">
    <!-- Basic Tab -->
    <div class="tab-content" id="tab-basic-lab">
      <div class="space-y-3">
        <!-- Lab Name -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Lab Name</label>
          <input
            type="text"
            id="lab-name"
            class="input-field w-full"
            placeholder="Enter lab name"
          />
          <small class="text-gray-500">
            Unique name to identify and distinguish this topology from others
          </small>
        </div>

        <!-- Prefix -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Container Name Prefix</label>
          <select id="lab-prefix-type" class="input-field w-full mb-2">
            <option value="default">Default (clab)</option>
            <option value="custom">Custom</option>
            <option value="no-prefix">No prefix</option>
          </select>
          <input
            type="text"
            id="lab-prefix-custom"
            class="input-field w-full"
            placeholder="Enter custom prefix"
            style="display: none"
          />
          <small class="text-gray-500">
            Default: clab-&lt;lab-name&gt;-&lt;node-name&gt; | No prefix: &lt;node-name&gt;
          </small>
        </div>
      </div>
    </div>

    <!-- Management Network Tab -->
    <div class="tab-content" id="tab-mgmt" style="display: none">
      <div class="space-y-3">
        <!-- Network Name -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Network Name</label>
          <input type="text" id="mgmt-network-name" class="input-field w-full" placeholder="clab" />
          <small class="text-gray-500">Docker network name (default: clab)</small>
        </div>

        <!-- IPv4 Configuration -->
        <div class="form-group">
          <label class="block vscode-label mb-1">IPv4 Subnet</label>
          <select id="mgmt-ipv4-type" class="input-field w-full mb-2">
            <option value="default">Default (172.20.20.0/24)</option>
            <option value="auto">Auto-assign</option>
            <option value="custom">Custom</option>
          </select>
          <input
            type="text"
            id="mgmt-ipv4-subnet"
            class="input-field w-full"
            placeholder="e.g., 172.100.100.0/24"
            style="display: none"
          />
        </div>

        <!-- IPv4 Gateway -->
        <div class="form-group" id="mgmt-ipv4-gateway-group" style="display: none">
          <label class="block vscode-label mb-1">IPv4 Gateway</label>
          <input
            type="text"
            id="mgmt-ipv4-gateway"
            class="input-field w-full"
            placeholder="e.g., 172.100.100.1"
          />
          <small class="text-gray-500">Custom gateway IP for the management bridge</small>
        </div>

        <!-- IPv4 Range -->
        <div class="form-group" id="mgmt-ipv4-range-group" style="display: none">
          <label class="block vscode-label mb-1">IPv4 Range</label>
          <input
            type="text"
            id="mgmt-ipv4-range"
            class="input-field w-full"
            placeholder="e.g., 172.100.100.128/25"
          />
          <small class="text-gray-500">Limit IP allocation range within the subnet</small>
        </div>

        <!-- IPv6 Configuration -->
        <div class="form-group">
          <label class="block vscode-label mb-1">IPv6 Subnet</label>
          <select id="mgmt-ipv6-type" class="input-field w-full mb-2">
            <option value="default">Default (3fff:172:20:20::/64)</option>
            <option value="auto">Auto-assign</option>
            <option value="custom">Custom</option>
          </select>
          <input
            type="text"
            id="mgmt-ipv6-subnet"
            class="input-field w-full"
            placeholder="e.g., 3fff:172:100:100::/80"
            style="display: none"
          />
        </div>

        <!-- IPv6 Gateway -->
        <div class="form-group" id="mgmt-ipv6-gateway-group" style="display: none">
          <label class="block vscode-label mb-1">IPv6 Gateway</label>
          <input
            type="text"
            id="mgmt-ipv6-gateway"
            class="input-field w-full"
            placeholder="e.g., 3fff:172:100:100::1"
          />
          <small class="text-gray-500">Custom IPv6 gateway IP for the management bridge</small>
        </div>

        <!-- MTU -->
        <div class="form-group">
          <label class="block vscode-label mb-1">MTU</label>
          <input
            type="number"
            id="mgmt-mtu"
            class="input-field w-full"
            placeholder="Default: auto"
          />
          <small class="text-gray-500">MTU size (defaults to docker0 interface MTU)</small>
        </div>

        <!-- Bridge Name -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Bridge Name</label>
          <input
            type="text"
            id="mgmt-bridge"
            class="input-field w-full"
            placeholder="Default: auto"
          />
          <small class="text-gray-500">
            Custom Linux bridge name (default: br-&lt;network-id&gt;)
          </small>
        </div>

        <!-- External Access -->
        <div class="form-group">
          <div class="flex items-center">
            <input type="checkbox" id="mgmt-external-access" class="vscode-checkbox mr-2" checked />
            <label for="mgmt-external-access" class="checkbox-label">Enable External Access</label>
          </div>
          <small class="text-gray-500">Allow external systems to reach lab nodes</small>
        </div>

        <!-- Bridge Driver Options -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Bridge Driver Options</label>
          <div id="driver-options-container" class="space-y-2">
            <!-- Driver options will be dynamically added here -->
          </div>
          <button id="add-driver-option" class="btn btn-small mt-2">
            <i class="fas fa-plus mr-1"></i>
            Add Option
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with buttons -->
  <div class="panel-block flex items-center flex-shrink-0">
    <div class="w-1/5 pr-1"></div>
    <div class="w-4/5 pl-2 pr-4 space-x-2 flex justify-end">
      <button id="lab-settings-apply" class="btn btn-primary btn-small">Save</button>
      <button id="lab-settings-cancel" class="btn btn-outlined btn-small">Close</button>
    </div>
  </div>
</div>

<script>
  // Lab Settings Panel functionality
  document.addEventListener("DOMContentLoaded", function () {
    const panel = document.getElementById("panel-lab-settings");
    const tabContainer = document.getElementById("lab-settings-tab-container");

    // Resize observer to calculate tab container height
    function resizeTabContainer() {
      const panelRect = panel.getBoundingClientRect();
      const tabContainerRect = tabContainer.getBoundingClientRect();
      const footer = panel.querySelector(".panel-block.flex.items-center");
      const footerRect = footer ? footer.getBoundingClientRect() : { height: 0 };

      // Calculate available height: panel height - everything above tab container - footer height
      const availableHeight =
        panelRect.height - (tabContainerRect.top - panelRect.top) - footerRect.height;

      if (availableHeight > 0) {
        tabContainer.style.height = `${availableHeight}px`;
      }
    }

    // Set up resize observer
    const resizeObserver = new ResizeObserver(() => {
      resizeTabContainer();
    });

    resizeObserver.observe(panel);

    // Initial resize
    setTimeout(resizeTabContainer, 0);

    // Tab switching
    const tabButtons = panel.querySelectorAll(".panel-tab-button");
    const tabContents = panel.querySelectorAll(".tab-content");

    tabButtons.forEach((button) => {
      button.addEventListener("click", () => {
        const targetTab = button.dataset.tab;

        // Update active tab button
        tabButtons.forEach((btn) => btn.classList.remove("tab-active"));
        button.classList.add("tab-active");

        // Show corresponding content
        tabContents.forEach((content) => {
          if (content.id === `tab-${targetTab}`) {
            content.style.display = "block";
          } else {
            content.style.display = "none";
          }
        });
      });
    });

    // Prefix type change handler
    const prefixType = document.getElementById("lab-prefix-type");
    const customPrefixInput = document.getElementById("lab-prefix-custom");

    prefixType.addEventListener("change", () => {
      if (prefixType.value === "custom") {
        customPrefixInput.style.display = "block";
      } else {
        customPrefixInput.style.display = "none";
      }
    });

    // IPv4 type change handler
    const ipv4Type = document.getElementById("mgmt-ipv4-type");
    const ipv4Subnet = document.getElementById("mgmt-ipv4-subnet");
    const ipv4GatewayGroup = document.getElementById("mgmt-ipv4-gateway-group");
    const ipv4RangeGroup = document.getElementById("mgmt-ipv4-range-group");

    ipv4Type.addEventListener("change", () => {
      if (ipv4Type.value === "custom") {
        ipv4Subnet.style.display = "block";
        ipv4GatewayGroup.style.display = "block";
        ipv4RangeGroup.style.display = "block";
      } else {
        ipv4Subnet.style.display = "none";
        ipv4GatewayGroup.style.display = "none";
        ipv4RangeGroup.style.display = "none";
      }
    });

    // IPv6 type change handler
    const ipv6Type = document.getElementById("mgmt-ipv6-type");
    const ipv6Subnet = document.getElementById("mgmt-ipv6-subnet");
    const ipv6GatewayGroup = document.getElementById("mgmt-ipv6-gateway-group");

    ipv6Type.addEventListener("change", () => {
      if (ipv6Type.value === "custom") {
        ipv6Subnet.style.display = "block";
        ipv6GatewayGroup.style.display = "block";
      } else {
        ipv6Subnet.style.display = "none";
        ipv6GatewayGroup.style.display = "none";
      }
    });

    // Add driver option handler
    const addDriverOptionBtn = document.getElementById("add-driver-option");
    const driverOptionsContainer = document.getElementById("driver-options-container");

    addDriverOptionBtn.addEventListener("click", () => {
      const optionRow = document.createElement("div");
      optionRow.className = "flex gap-2 driver-option-row";
      optionRow.innerHTML = `
        <input type="text" class="input-field flex-1" placeholder="Option key">
        <input type="text" class="input-field flex-1" placeholder="Option value">
        <button class="btn-icon remove-driver-option">
          <i class="fas fa-times"></i>
        </button>
      `;

      // Add remove handler
      optionRow.querySelector(".remove-driver-option").addEventListener("click", () => {
        optionRow.remove();
      });

      driverOptionsContainer.appendChild(optionRow);
    });

    // Cancel button
    document.getElementById("lab-settings-cancel").addEventListener("click", () => {
      panel.style.display = "none";
    });

    // Apply button
    document.getElementById("lab-settings-apply").addEventListener("click", () => {
      // Trigger save event
      const event = new CustomEvent("lab-settings-apply", {
        detail: gatherLabSettings()
      });
      document.dispatchEvent(event);
      // Panel stays open after saving
    });

    // Function to gather all settings
    function gatherLabSettings() {
      const settings = {
        name: document.getElementById("lab-name").value,
        prefix: getPrefixValue()
      };

      // Management network settings - only add mgmt if we have values
      const mgmt = {};
      let hasMgmtSettings = false;

      const mgmtNetwork = document.getElementById("mgmt-network-name").value;
      if (mgmtNetwork) {
        mgmt.network = mgmtNetwork;
        hasMgmtSettings = true;
      }

      // IPv4 settings
      const ipv4Value = getIpv4Value();
      if (ipv4Value) {
        mgmt["ipv4-subnet"] = ipv4Value;
        hasMgmtSettings = true;
      }

      if (ipv4Type.value === "custom") {
        const ipv4Gw = document.getElementById("mgmt-ipv4-gateway").value;
        if (ipv4Gw) mgmt["ipv4-gw"] = ipv4Gw;

        const ipv4Range = document.getElementById("mgmt-ipv4-range").value;
        if (ipv4Range) mgmt["ipv4-range"] = ipv4Range;
      }

      // IPv6 settings
      const ipv6Value = getIpv6Value();
      if (ipv6Value) {
        mgmt["ipv6-subnet"] = ipv6Value;
        hasMgmtSettings = true;
      }

      if (ipv6Type.value === "custom") {
        const ipv6Gw = document.getElementById("mgmt-ipv6-gateway").value;
        if (ipv6Gw) mgmt["ipv6-gw"] = ipv6Gw;
      }

      // Other management settings
      const mtu = document.getElementById("mgmt-mtu").value;
      if (mtu) {
        mgmt.mtu = parseInt(mtu);
        hasMgmtSettings = true;
      }

      const bridge = document.getElementById("mgmt-bridge").value;
      if (bridge) {
        mgmt.bridge = bridge;
        hasMgmtSettings = true;
      }

      const externalAccess = document.getElementById("mgmt-external-access").checked;
      if (!externalAccess) {
        mgmt["external-access"] = false;
        hasMgmtSettings = true;
      }

      // Driver options
      const driverOptions = {};
      driverOptionsContainer.querySelectorAll(".driver-option-row").forEach((row) => {
        const inputs = row.querySelectorAll("input");
        if (inputs[0].value && inputs[1].value) {
          driverOptions[inputs[0].value] = inputs[1].value;
        }
      });
      if (Object.keys(driverOptions).length > 0) {
        mgmt["driver-opts"] = driverOptions;
        hasMgmtSettings = true;
      }

      // Add mgmt to settings - either with values or null to trigger deletion
      if (hasMgmtSettings) {
        settings.mgmt = mgmt;
      } else {
        settings.mgmt = null; // Explicitly null to trigger deletion
      }

      return settings;
    }

    function getPrefixValue() {
      const type = prefixType.value;
      switch (type) {
        case "custom":
          return customPrefixInput.value;
        case "no-prefix":
          return "";
        case "default":
          return null; // Explicitly null to trigger deletion
        default:
          return null; // Explicitly null to trigger deletion
      }
    }

    function getIpv4Value() {
      const type = ipv4Type.value;
      switch (type) {
        case "auto":
          return "auto";
        case "custom":
          return document.getElementById("mgmt-ipv4-subnet").value;
        default:
          return undefined; // Use default
      }
    }

    function getIpv6Value() {
      const type = ipv6Type.value;
      switch (type) {
        case "auto":
          return "auto";
        case "custom":
          return document.getElementById("mgmt-ipv6-subnet").value;
        default:
          return undefined; // Use default
      }
    }

    // Panel drag handling is managed by draggable-panels.html script
  });

  // Global function to show the lab settings panel
  function showLabSettingsPanel(settings) {
    const panel = document.getElementById("panel-lab-settings");
    const isViewMode =
      window.topoViewerMode === "viewer" ||
      (window.topoViewerState && window.topoViewerState.currentMode === "viewer");

    // Populate with current settings if provided
    if (settings) {
      // Basic settings
      if (settings.name) document.getElementById("lab-name").value = settings.name;

      // Handle prefix
      if (settings.prefix !== undefined) {
        const prefixType = document.getElementById("lab-prefix-type");
        const customInput = document.getElementById("lab-prefix-custom");

        if (settings.prefix === "") {
          prefixType.value = "no-prefix";
        } else if (settings.prefix && settings.prefix !== "clab") {
          prefixType.value = "custom";
          customInput.value = settings.prefix;
          customInput.style.display = "block";
        } else {
          prefixType.value = "default";
        }
      }

      // Management network settings
      if (settings.mgmt) {
        if (settings.mgmt.network) {
          document.getElementById("mgmt-network-name").value = settings.mgmt.network;
        }

        // IPv4 settings
        handleIpv4Settings(settings.mgmt);

        // IPv6 settings
        handleIpv6Settings(settings.mgmt);

        // Other settings
        if (settings.mgmt.mtu) {
          document.getElementById("mgmt-mtu").value = settings.mgmt.mtu;
        }

        if (settings.mgmt.bridge) {
          document.getElementById("mgmt-bridge").value = settings.mgmt.bridge;
        }

        if (settings.mgmt["external-access"] !== undefined) {
          document.getElementById("mgmt-external-access").checked =
            settings.mgmt["external-access"];
        }

        // Driver options
        if (settings.mgmt["driver-opts"]) {
          populateDriverOptions(settings.mgmt["driver-opts"]);
        }
      }
    }

    // Handle viewer mode
    if (isViewMode) {
      // Disable all inputs and selects
      panel.querySelectorAll("input, select, textarea, button.btn-secondary").forEach((element) => {
        element.disabled = true;
        element.style.opacity = "0.6";
        element.style.cursor = "not-allowed";
      });

      // Hide the save button, only show close
      const saveBtn = document.getElementById("lab-settings-apply");
      if (saveBtn) {
        saveBtn.style.display = "none";
      }

      // Hide the add driver option button
      const addDriverBtn = document.getElementById("add-driver-option");
      if (addDriverBtn) {
        addDriverBtn.style.display = "none";
      }

      // Hide all remove driver option buttons
      panel.querySelectorAll(".remove-driver-option").forEach((btn) => {
        btn.style.display = "none";
      });
    } else {
      // Enable all inputs and selects in editor mode
      panel.querySelectorAll("input, select, textarea, button.btn-secondary").forEach((element) => {
        element.disabled = false;
        element.style.opacity = "1";
        element.style.cursor = "";
      });

      // Show the save button
      const saveBtn = document.getElementById("lab-settings-apply");
      if (saveBtn) {
        saveBtn.style.display = "";
      }

      // Show the add driver option button
      const addDriverBtn = document.getElementById("add-driver-option");
      if (addDriverBtn) {
        addDriverBtn.style.display = "";
      }
    }

    panel.style.display = "block";
  }

  function handleIpv4Settings(mgmt) {
    const ipv4Type = document.getElementById("mgmt-ipv4-type");
    const ipv4Subnet = document.getElementById("mgmt-ipv4-subnet");
    const ipv4GatewayGroup = document.getElementById("mgmt-ipv4-gateway-group");
    const ipv4RangeGroup = document.getElementById("mgmt-ipv4-range-group");

    if (mgmt["ipv4-subnet"]) {
      if (mgmt["ipv4-subnet"] === "auto") {
        ipv4Type.value = "auto";
      } else {
        ipv4Type.value = "custom";
        ipv4Subnet.value = mgmt["ipv4-subnet"];
        ipv4Subnet.style.display = "block";
        ipv4GatewayGroup.style.display = "block";
        ipv4RangeGroup.style.display = "block";

        if (mgmt["ipv4-gw"]) {
          document.getElementById("mgmt-ipv4-gateway").value = mgmt["ipv4-gw"];
        }

        if (mgmt["ipv4-range"]) {
          document.getElementById("mgmt-ipv4-range").value = mgmt["ipv4-range"];
        }
      }
    }
  }

  function handleIpv6Settings(mgmt) {
    const ipv6Type = document.getElementById("mgmt-ipv6-type");
    const ipv6Subnet = document.getElementById("mgmt-ipv6-subnet");
    const ipv6GatewayGroup = document.getElementById("mgmt-ipv6-gateway-group");

    if (mgmt["ipv6-subnet"]) {
      if (mgmt["ipv6-subnet"] === "auto") {
        ipv6Type.value = "auto";
      } else {
        ipv6Type.value = "custom";
        ipv6Subnet.value = mgmt["ipv6-subnet"];
        ipv6Subnet.style.display = "block";
        ipv6GatewayGroup.style.display = "block";

        if (mgmt["ipv6-gw"]) {
          document.getElementById("mgmt-ipv6-gateway").value = mgmt["ipv6-gw"];
        }
      }
    }
  }

  function populateDriverOptions(driverOpts) {
    const container = document.getElementById("driver-options-container");
    container.innerHTML = ""; // Clear existing

    Object.entries(driverOpts).forEach(([key, value]) => {
      const optionRow = document.createElement("div");
      optionRow.className = "flex gap-2 driver-option-row";
      optionRow.innerHTML = `
        <input type="text" class="input-field flex-1" value="${key}">
        <input type="text" class="input-field flex-1" value="${value}">
        <button class="btn-icon remove-driver-option">
          <i class="fas fa-times"></i>
        </button>
      `;

      optionRow.querySelector(".remove-driver-option").addEventListener("click", () => {
        optionRow.remove();
      });

      container.appendChild(optionRow);
    });
  }

  // Export function to global scope
  window.showLabSettingsPanel = showLabSettingsPanel;
</script>

      <aside
  id="panel-topoviewer-about"
  class="panel panel-overlay fixed bottom-10 right-10 w-[380px] max-h-[700px] overflow-y-auto z-[21] draggable-panel"
  role="complementary"
  aria-labelledby="about-heading"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="about-heading">
    <span class="panel-title">About TopoViewer</span>
    <button class="panel-close-btn" id="panel-about-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="p-4">
    <article class="max-h-[600px] overflow-y-auto">
      <section class="space-y-4">
        <!-- Authors Section -->
        <div>
          <h3 class="text-sm font-semibold mb-2 opacity-80">Authors & Maintainers</h3>
          <div class="text-sm space-y-1.5 pl-2">
            <p class="font-normal">
              <span class="opacity-60">TopoViewer originally created by</span>
              <a
                href="https://www.linkedin.com/in/asadarafat/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Asad Arafat
              </a>
            </p>
            <p class="font-normal">
              <span class="opacity-60">Integrated into VSCode by</span>
              <a
                href="https://www.linkedin.com/in/asadarafat/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Asad Arafat
              </a>
              ,
              <a
                href="https://linkedin.com/in/florian-schwarz-812a34145"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Florian Schwarz
              </a>
              ,
              <a
                href="https://linkedin.com/in/kaelem-chandra"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Kaelem Chandra
              </a>
            </p>
          </div>
        </div>

        <!-- Repositories Section -->
        <div>
          <h3 class="text-sm font-semibold mb-2 opacity-80">Repositories</h3>
          <div class="text-sm space-y-1.5 pl-2">
            <div class="font-normal">
              <span class="opacity-60">VSCode Extension:</span>
              <a
                href="https://github.com/srl-labs/vscode-containerlab/"
                target="_blank"
                rel="noopener"
                class="link font-medium break-all"
              >
                github.com/srl-labs/vscode-containerlab
              </a>
            </div>
            <div class="font-normal">
              <span class="opacity-60">Original TopoViewer:</span>
              <a
                href="https://github.com/asadarafat/topoViewer"
                target="_blank"
                rel="noopener"
                class="link font-medium break-all"
              >
                github.com/asadarafat/topoViewer
              </a>
            </div>
          </div>
        </div>

        <!-- Special Thanks Section -->
        <div>
          <h3 class="text-sm font-semibold mb-2 opacity-80">Special Thanks</h3>
          <div class="text-sm space-y-1 pl-2">
            <div class="font-normal">
              <a
                href="https://www.linkedin.com/in/rdodin/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Roman Dodin
              </a>
              <span class="opacity-60">â Early-stage guidance</span>
            </div>
            <div class="font-normal">
              <a
                href="https://www.linkedin.com/in/siva19susi/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Siva Sivakumar
              </a>
              <span class="opacity-60">â CSS framework integration</span>
            </div>
            <div class="font-normal">
              <a
                href="https://www.linkedin.com/in/gatot-susilo-b073166/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Gatot Susilo
              </a>
              <span class="opacity-60">â Komodo2 integration</span>
            </div>
            <div class="font-normal">
              <a
                href="https://www.linkedin.com/in/gusman-dharma-putra-1b955117/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Gusman Dharma Putra
              </a>
              <span class="opacity-60">â Komodo2 contributions</span>
            </div>
            <div class="font-normal">
              <a
                href="https://www.linkedin.com/in/sven-wisotzky-44788333/"
                target="_blank"
                rel="noopener"
                class="link font-medium"
              >
                Sven Wisotzky
              </a>
              <span class="opacity-60">â Full-stack optimizations</span>
            </div>
          </div>
        </div>
      </section>
    </article>
  </div>
</aside>

      <!-- Link Properties Panel -->
<section
  class="panel panel-overlay bottom-10 left-20 draggable-panel overflow-hidden"
  id="panel-link"
  style="display: none"
>
  <div class="panel-heading panel-title-bar">
    <span class="panel-title">Link Properties</span>
    <button class="panel-close-btn" id="panel-link-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="p-0 pb-2 flex flex-col h-[calc(100%-40px)] overflow-hidden">
    <!-- Tabs for endpoints -->
    <div class="flex border-b border-gray-700 shrink-0">
      <button class="endpoint-tab panel-tab-button tab-active" data-endpoint="a">Endpoint A</button>
      <button class="endpoint-tab panel-tab-button" data-endpoint="b">Endpoint B</button>
    </div>

    <!-- Tab content containers -->
    <div id="endpoint-a-content" class="endpoint-content flex-1 flex flex-col min-h-0">
      <div class="grid grid-cols-3 gap-4 mb-3 mt-2 px-4 shrink-0">
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">MAC</span>
          <span
            id="panel-link-endpoint-a-mac-address"
            class="text-sm text-[var(--vscode-foreground)]"
          >
            N/A
          </span>
        </div>
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">MTU</span>
          <span id="panel-link-endpoint-a-mtu" class="text-sm text-[var(--vscode-foreground)]">
            N/A
          </span>
        </div>
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">Type</span>
          <span id="panel-link-endpoint-a-type" class="text-sm text-[var(--vscode-foreground)]">
            N/A
          </span>
        </div>
      </div>
      <div class="graph-container flex-1 min-h-0">
        <div id="panel-link-endpoint-a-graph" class="w-full h-full mb-1"></div>
      </div>
    </div>

    <div
      id="endpoint-b-content"
      class="endpoint-content flex-1 flex flex-col min-h-0"
      style="display: none"
    >
      <div class="grid grid-cols-3 gap-4 mb-3 mt-2 px-4 shrink-0">
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">MAC</span>
          <span
            id="panel-link-endpoint-b-mac-address"
            class="text-sm text-[var(--vscode-foreground)]"
          >
            N/A
          </span>
        </div>
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">MTU</span>
          <span id="panel-link-endpoint-b-mtu" class="text-sm text-[var(--vscode-foreground)]">
            N/A
          </span>
        </div>
        <div class="flex flex-col items-center">
          <span class="vscode-label text-xs mb-1 font-bold">Type</span>
          <span id="panel-link-endpoint-b-type" class="text-sm text-[var(--vscode-foreground)]">
            N/A
          </span>
        </div>
      </div>
      <div class="graph-container flex-1 min-h-0">
        <div id="panel-link-endpoint-b-graph" class="w-full h-full mb-1"></div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Tab switching functionality
    const tabs = document.querySelectorAll(".endpoint-tab");
    const contents = document.querySelectorAll(".endpoint-content");

    tabs.forEach((tab) => {
      tab.addEventListener("click", function () {
        const endpoint = this.getAttribute("data-endpoint");

        // Update tab styles - use tab-active class like node editor
        tabs.forEach((t) => {
          t.classList.remove("tab-active");
        });
        this.classList.add("tab-active");

        // Update content visibility
        contents.forEach((content) => {
          content.style.display = "none";
        });
        const activeContent = document.getElementById(`endpoint-${endpoint}-content`);
        if (activeContent) {
          activeContent.style.display = "flex";
          // Dispatch event to trigger graph resize after tab switch
          window.dispatchEvent(new CustomEvent("link-tab-switched", { detail: { endpoint } }));
        }
      });
    });
  });
</script>

      <!-- Unified Link Editor Panel (Tabbed: Basic | Extended) -->
<div
  class="panel panel-overlay panel-editor fixed bottom-10 left-20 overflow-hidden z-[21] draggable-panel flex flex-col"
  id="panel-link-editor"
  style="display: none"
>
  <div class="panel-heading panel-title-bar">
    <span class="panel-title">Link Editor</span>
    <button class="panel-close-btn" id="panel-link-editor-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Tab Navigation -->
  <div class="panel-tabs" style="justify-content: flex-start">
    <button class="panel-tab-button tab-active" id="panel-link-tab-btn-basic" data-tab="basic">
      Basic
    </button>
    <button class="panel-tab-button" id="panel-link-tab-btn-extended" data-tab="extended">
      Extended
    </button>
  </div>

  <!-- Tab Content Container -->
  <div class="panel-block p-2 overflow-y-auto" id="link-editor-tab-container">
    <!-- Basic Tab -->
    <div class="tab-content" id="panel-link-tab-basic" style="display: block">
      <div class="space-y-3">
        <!-- Link preview -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Link Name</label>
          <div>
            <span
              id="panel-link-editor-id"
              class="text-base px-2 py-1 inline-block rounded"
              style="
                background-color: var(--vscode-textBlockQuote-background);
                border: 1px solid var(--vscode-textBlockQuote-border);
              "
            ></span>
          </div>
        </div>
        <!-- Source Endpoint -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Source Endpoint</label>
          <input
            type="text"
            id="panel-link-editor-source-endpoint"
            class="input-field w-full"
            placeholder="e.g., eth1, e1-1"
          />
        </div>
        <!-- Target Endpoint -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Target Endpoint</label>
          <input
            type="text"
            id="panel-link-editor-target-endpoint"
            class="input-field w-full"
            placeholder="e.g., eth1, e1-1"
          />
        </div>
      </div>
    </div>

    <!-- Extended Tab -->
    <div class="tab-content" id="panel-link-tab-extended" style="display: none">
      <div class="space-y-3">
        <!-- Basic Information Section -->
        <div class="border-b pb-3 mb-3" style="border-color: var(--vscode-panel-border)">
          <!-- Link preview -->
          <div class="form-group">
            <label class="block vscode-label mb-1">Link Name</label>
            <div>
              <span
                id="panel-link-extended-editor-id"
                class="text-base px-2 py-1 inline-block rounded"
                style="
                  background-color: var(--vscode-textBlockQuote-background);
                  border: 1px solid var(--vscode-textBlockQuote-border);
                "
              ></span>
            </div>
          </div>

          <!-- Validation banner -->
          <div
            id="panel-link-ext-errors"
            style="display: none"
            class="my-2 p-2 rounded bg-[var(--vscode-inputValidation-errorBackground)] border border-[var(--vscode-inputValidation-errorBorder)]"
          >
            <div class="text-[var(--vscode-editorError-foreground)] text-sm font-semibold">
              Invalid link configuration
            </div>
            <div
              id="panel-link-ext-errors-list"
              class="text-[var(--vscode-editorError-foreground)] text-xs mt-1"
            ></div>
          </div>

          <!-- Type dropdown -->
          <div class="form-group">
            <label class="block vscode-label mb-1">Type</label>
            <div>
              <span
                id="panel-link-ext-type-display"
                class="text-base px-2 py-1 inline-block rounded"
                style="
                  background-color: var(--vscode-textBlockQuote-background);
                  border: 1px solid var(--vscode-textBlockQuote-border);
                "
              >
                veth
              </span>
              <span class="text-xs text-[var(--vscode-descriptionForeground)] ml-2">
                (auto-detected)
              </span>
            </div>
          </div>
        </div>

        <!-- Common fields -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Source MAC</label>
          <input
            type="text"
            id="panel-link-ext-src-mac"
            class="input-field w-full"
            placeholder="e.g., 02:42:ac:11:00:01"
          />
        </div>
        <div class="form-group">
          <label class="block vscode-label mb-1">Target MAC</label>
          <input
            type="text"
            id="panel-link-ext-tgt-mac"
            class="input-field w-full"
            placeholder="e.g., 02:42:ac:11:00:02"
          />
        </div>
        <div class="form-group">
          <label class="block vscode-label mb-1">MTU</label>
          <input
            type="number"
            id="panel-link-ext-mtu"
            class="input-field w-full"
            placeholder="e.g., 1500"
          />
        </div>

        <div id="panel-link-vars-placeholder"></div>

        <!-- Labels -->
        <div class="form-group">
          <label class="block vscode-label mb-1">Labels</label>
          <div id="panel-link-ext-labels-container" class="space-y-2"></div>
          <button class="btn btn-small mt-2" onclick="addLinkLabelEntry()">
            <i class="fas fa-plus mr-1"></i>
            Add Label
          </button>
        </div>

        <!-- Info message for non-veth links -->
        <div class="my-1" id="panel-link-ext-non-veth-info" style="display: none">
          <div
            class="p-2 rounded bg-[var(--vscode-textBlockQuote-background)] border border-[var(--vscode-textBlockQuote-border)]"
          >
            <div class="text-sm">
              <span class="font-semibold">Note:</span>
              This link connects to a network node. Configure extended properties on the network
              node itself.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="panel-link-footer-placeholder" class="flex-shrink-0"></div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const varsTpl = document.getElementById("vars-section-template");
      const footerTpl = document.getElementById("editor-footer-template");
      if (varsTpl && footerTpl) {
        const varsFrag = varsTpl.content.cloneNode(true);
        const varsContainer = varsFrag.querySelector(".vars-container");
        const addBtn = varsFrag.querySelector(".add-var-btn");
        if (varsContainer) {
          varsContainer.id = "panel-link-ext-vars-container";
        }
        if (addBtn) {
          addBtn.setAttribute("onclick", "addLinkVarEntry()");
        }
        document.getElementById("panel-link-vars-placeholder")?.appendChild(varsFrag);

        const footerFrag = footerTpl.content.cloneNode(true);
        const saveBtn = footerFrag.querySelector(".editor-save-btn");
        const applyBtn = footerFrag.querySelector(".editor-apply-btn");
        if (saveBtn) {
          saveBtn.id = "panel-link-editor-save-button";
        }
        if (applyBtn) {
          applyBtn.id = "panel-link-editor-apply-button";
        }
        document.getElementById("panel-link-footer-placeholder")?.appendChild(footerFrag);
      }

      // Resize observer to calculate tab container height
      const panel = document.getElementById("panel-link-editor");
      const tabContainer = document.getElementById("link-editor-tab-container");

      function resizeTabContainer() {
        if (!panel || !tabContainer) return;
        const panelRect = panel.getBoundingClientRect();
        const tabContainerRect = tabContainer.getBoundingClientRect();
        const footer = document.getElementById("panel-link-footer-placeholder");
        const footerRect = footer ? footer.getBoundingClientRect() : { height: 0 };

        // Calculate available height: panel height - everything above tab container - footer height
        const availableHeight =
          panelRect.height - (tabContainerRect.top - panelRect.top) - footerRect.height;

        if (availableHeight > 0) {
          tabContainer.style.height = `${availableHeight}px`;
        }
      }

      // Set up resize observer
      const resizeObserver = new ResizeObserver(() => {
        resizeTabContainer();
      });

      resizeObserver.observe(panel);

      // Initial resize after a short delay to ensure footer is rendered
      setTimeout(resizeTabContainer, 100);
    });
  </script>
</div>

      <section
  class="panel panel-overlay bottom-10 left-20 w-[360px] max-h-[700px] overflow-y-auto overflow-x-hidden draggable-panel"
  id="panel-bulk-link"
  aria-labelledby="bulk-link-panel-heading"
  style="display: none"
>
  <div class="panel-heading panel-title-bar" id="bulk-link-panel-heading">
    <span class="panel-title">Bulk Link Devices</span>
    <button class="panel-close-btn" id="panel-bulk-link-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="panel-block p-0">
    <div class="pl-4 pb-2">
      <p class="pr-4 pb-2 text-sm leading-snug text-secondary">
        Enter patterns to connect multiple devices at once. Source Pattern selects the starting
        nodes and Target Pattern selects destinations for each source. You can use wildcards (
        <code>*</code>
        ,
        <code>?</code>
        ,
        <code>#</code>
        ) or regular expressions. Capture placeholders like
        <code>$1</code>
        or
        <code>$&lt;name&gt;</code>
        are only filled when the source pattern is a regular expression with capturing groups.
      </p>
      <p class="pr-4 pb-2 text-sm leading-snug text-secondary">
        For example, matching
        <code>leaf*</code>
        to
        <code>spine*</code>
        links every leaf to all spines. To pair numbered devices, use a regex source such as
        <code>leaf?(\d+)</code>
        with a target of
        <code>spine$1</code>
        to connect each leaf to the spine that shares its index.
      </p>
      <div class="px-0">
        <!-- Source Pattern -->
        <div class="my-1">
          <div class="p-0.5">
            <div class="flex items-center">
              <div class="w-2/5 pr-1">
                <label class="label text-right text-base font-semibold">Source Pattern</label>
              </div>
              <div class="w-3/5 pl-2 pr-2">
                <input
                  type="text"
                  class="input-field text-base w-full"
                  id="source-regex"
                  placeholder="e.g. leaf, srl?(\d+) or ^core-.$"
                />
              </div>
            </div>
          </div>
        </div>
        <!-- Target Pattern -->
        <div class="my-1">
          <div class="p-0.5">
            <div class="flex items-center">
              <div class="w-2/5 pr-1">
                <label class="label text-right text-base font-semibold">Target Pattern</label>
              </div>
              <div class="w-3/5 pl-2 pr-2">
                <input
                  type="text"
                  class="input-field text-base w-full"
                  id="target-regex"
                  placeholder="e.g. spine, client$1 or ^edge-.$"
                />
              </div>
            </div>
          </div>
        </div>
        <!-- Action Buttons -->
        <div class="my-1">
          <div class="p-0.5">
            <div class="flex items-center">
              <div class="w-2/5 pr-1"></div>
              <div class="w-3/5 pl-2 pr-2">
                <div class="flex justify-end space-x-2">
                  <button class="btn btn-secondary btn-small" id="bulk-link-cancel">Cancel</button>
                  <button class="btn btn-primary btn-small" id="bulk-link-apply">Apply</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
<script>
  // Event listeners remain the same
  document.getElementById("bulk-link-cancel").addEventListener("click", () => {
    document.getElementById("panel-bulk-link").style.display = "none";
  });
  document.getElementById("bulk-link-apply").addEventListener("click", async () => {
    const source = document.getElementById("source-regex").value;
    const target = document.getElementById("target-regex").value;
    if (source && target) {
      await window.topologyWebviewController.bulkCreateLinks(source, target);
      document.getElementById("panel-bulk-link").style.display = "none";
    }
  });
</script>

      <!-- Free Text Editor Panel -->
<div
  id="panel-free-text"
  class="panel panel-overlay panel-editor fixed overflow-hidden z-[21] draggable-panel flex flex-col"
  style="display: none"
>
  <div class="panel-heading panel-title-bar flex-shrink-0" id="panel-free-text-heading">
    <span class="panel-title" id="panel-free-text-title">Add Text</span>
    <button class="panel-close-btn" id="panel-free-text-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="panel-block p-4 overflow-y-auto" id="panel-free-text-content">
    <div class="space-y-4">
      <!-- Text Input -->
      <div class="form-group">
        <label for="free-text-modal-text" class="vscode-label mb-1">Text:</label>
        <div class="flex items-center gap-2 mb-2">
          <div class="flex items-center gap-2">
            <button id="free-text-tab-write" class="btn btn-small btn-primary">Write</button>
            <button id="free-text-tab-preview" class="btn btn-small btn-outlined">Preview</button>
          </div>
          <span class="text-xs text-[var(--text-secondary)] italic ml-auto">
            Markdown and fenced code blocks supported
          </span>
        </div>
        <div class="w-full">
          <textarea
            id="free-text-modal-text"
            class="input-field w-full h-36 mb-2 resize-y"
          ></textarea>
          <div
            id="free-text-preview-container"
            class="input-field w-full h-36 overflow-auto hidden"
          >
            <div
              id="free-text-preview"
              class="text-sm leading-relaxed whitespace-pre-wrap break-words free-text-markdown"
            ></div>
          </div>
        </div>
      </div>

      <!-- Font Settings -->
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label for="free-text-font-size" class="vscode-label mb-1">Font Size:</label>
          <input
            id="free-text-font-size"
            type="number"
            min="1"
            max="72"
            class="input-field w-full"
          />
        </div>
        <div class="form-group">
          <label for="free-text-font-family" class="vscode-label mb-1">Font Family:</label>
          <select id="free-text-font-family" class="input-field w-full"></select>
        </div>
        <div class="form-group">
          <label for="free-text-font-color" class="vscode-label mb-1">Text Color:</label>
          <input id="free-text-font-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label for="free-text-bg-color" class="vscode-label mb-1">Background:</label>
          <input id="free-text-bg-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label for="free-text-rotation" class="vscode-label mb-1">Rotation (deg):</label>
          <input
            id="free-text-rotation"
            type="number"
            min="-360"
            max="360"
            step="1"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Formatting Buttons -->
      <div class="flex flex-wrap items-center gap-2">
        <button id="free-text-bold-btn" class="btn btn-small btn-outlined">
          <strong>B</strong>
        </button>
        <button id="free-text-italic-btn" class="btn btn-small btn-outlined"><em>I</em></button>
        <button id="free-text-underline-btn" class="btn btn-small btn-outlined"><u>U</u></button>
        <button id="free-text-transparent-btn" class="btn btn-small btn-outlined ml-auto">
          Transparent BG
        </button>
        <button id="free-text-rounded-btn" class="btn btn-small btn-outlined">
          Rounded Corners
        </button>
      </div>

      <!-- Alignment -->
      <div class="flex flex-wrap items-center gap-2 justify-end">
        <span class="text-xs uppercase tracking-wide text-[var(--text-secondary)]">Align</span>
        <div class="flex items-center gap-1">
          <button
            id="free-text-align-left-btn"
            class="btn btn-small btn-outlined"
            aria-label="Align text left"
          >
            <i class="fas fa-align-left text-sm" aria-hidden="true"></i>
          </button>
          <button
            id="free-text-align-center-btn"
            class="btn btn-small btn-outlined"
            aria-label="Align text center"
          >
            <i class="fas fa-align-center text-sm" aria-hidden="true"></i>
          </button>
          <button
            id="free-text-align-right-btn"
            class="btn btn-small btn-outlined"
            aria-label="Align text right"
          >
            <i class="fas fa-align-right text-sm" aria-hidden="true"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer with buttons (same style as editor-footer-template) -->
  <div
    id="panel-free-text-footer"
    class="panel-block flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--vscode-panel-border)] bg-[var(--vscode-sideBar-background)] flex-shrink-0"
  >
    <button id="free-text-ok-btn" class="btn btn-primary btn-small" title="Apply changes and close">
      OK
    </button>
    <button
      id="free-text-apply-btn"
      class="btn btn-outlined btn-small"
      title="Apply changes without closing"
    >
      Apply
    </button>
  </div>

  <script>
    (function () {
      const panel = document.getElementById("panel-free-text");
      const content = document.getElementById("panel-free-text-content");
      const footer = document.getElementById("panel-free-text-footer");

      function resizeContent() {
        if (!panel || !content || !footer) return;
        const panelRect = panel.getBoundingClientRect();
        const contentRect = content.getBoundingClientRect();
        const footerHeight = footer.getBoundingClientRect().height;

        const availableHeight = panelRect.height - (contentRect.top - panelRect.top) - footerHeight;

        if (availableHeight > 0) {
          content.style.height = `${availableHeight}px`;
        }
      }

      const resizeObserver = new ResizeObserver(() => {
        resizeContent();
      });

      resizeObserver.observe(panel);
      setTimeout(resizeContent, 100);
    })();
  </script>
</div>

      <!-- Free Shapes Editor Panel -->
<div
  id="panel-free-shapes"
  class="panel panel-overlay panel-editor fixed overflow-hidden z-[21] draggable-panel flex flex-col"
  style="display: none"
>
  <div class="panel-heading panel-title-bar flex-shrink-0" id="panel-free-shapes-heading">
    <span class="panel-title" id="panel-free-shapes-title">Add Shape</span>
    <button class="panel-close-btn" id="panel-free-shapes-close" aria-label="Close" title="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="panel-block p-4 overflow-y-auto" id="panel-free-shapes-content">
    <div class="space-y-4">
      <!-- Shape Type Selector -->
      <div class="form-group">
        <label for="free-shapes-type" class="vscode-label mb-1">Shape Type:</label>
        <select id="free-shapes-type" class="input-field w-full">
          <option value="rectangle">Rectangle</option>
          <option value="circle">Circle</option>
          <option value="line">Line</option>
        </select>
      </div>

      <!-- Size controls (for rectangle and circle) -->
      <div id="free-shapes-size-controls" class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label for="free-shapes-width" class="vscode-label mb-1">Width:</label>
          <input
            id="free-shapes-width"
            type="number"
            min="5"
            max="2000"
            class="input-field w-full"
          />
        </div>
        <div class="form-group">
          <label for="free-shapes-height" class="vscode-label mb-1">Height:</label>
          <input
            id="free-shapes-height"
            type="number"
            min="5"
            max="2000"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Fill controls (hidden for lines) -->
      <div id="free-shapes-fill-controls" class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label for="free-shapes-fill-color" class="vscode-label mb-1">Fill Color:</label>
          <input id="free-shapes-fill-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label for="free-shapes-fill-opacity" class="vscode-label mb-1">Fill Opacity:</label>
          <input
            id="free-shapes-fill-opacity"
            type="range"
            min="0"
            max="100"
            step="1"
            class="input-field w-full"
          />
          <span id="free-shapes-fill-opacity-value" class="text-xs text-[var(--text-secondary)]">
            100%
          </span>
        </div>
      </div>

      <!-- Border/Line controls -->
      <div class="grid grid-cols-2 gap-4">
        <div class="form-group">
          <label
            id="free-shapes-border-color-label"
            for="free-shapes-border-color"
            class="vscode-label mb-1"
          >
            Border Color:
          </label>
          <input id="free-shapes-border-color" type="color" class="input-field w-full h-8 p-1" />
        </div>
        <div class="form-group">
          <label
            id="free-shapes-border-width-label"
            for="free-shapes-border-width"
            class="vscode-label mb-1"
          >
            Border Width:
          </label>
          <input
            id="free-shapes-border-width"
            type="number"
            min="0"
            max="20"
            step="1"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Border/Line Style -->
      <div class="form-group">
        <label
          id="free-shapes-border-style-label"
          for="free-shapes-border-style"
          class="vscode-label mb-1"
        >
          Border Style:
        </label>
        <select id="free-shapes-border-style" class="input-field w-full">
          <option value="solid">Solid</option>
          <option value="dashed">Dashed</option>
          <option value="dotted">Dotted</option>
        </select>
      </div>

      <!-- Rectangle-specific: Corner Radius -->
      <div id="free-shapes-corner-radius-control" class="form-group">
        <label for="free-shapes-corner-radius" class="vscode-label mb-1">Corner Radius:</label>
        <input
          id="free-shapes-corner-radius"
          type="number"
          min="0"
          max="100"
          step="1"
          class="input-field w-full"
        />
      </div>

      <!-- Line-specific controls -->
      <div id="free-shapes-line-controls" class="form-group" style="display: none">
        <div class="flex items-center gap-4 mb-2">
          <label class="flex items-center gap-2 cursor-pointer">
            <input id="free-shapes-line-start-arrow" type="checkbox" class="vscode-checkbox" />
            <span class="checkbox-label">Start Arrow</span>
          </label>
          <label class="flex items-center gap-2 cursor-pointer">
            <input id="free-shapes-line-end-arrow" type="checkbox" class="vscode-checkbox" />
            <span class="checkbox-label">End Arrow</span>
          </label>
        </div>
        <div>
          <label for="free-shapes-arrow-size" class="vscode-label mb-1">Arrow Size:</label>
          <input
            id="free-shapes-arrow-size"
            type="number"
            min="5"
            max="50"
            step="1"
            class="input-field w-full"
          />
        </div>
      </div>

      <!-- Rotation (hidden for lines) -->
      <div id="free-shapes-rotation-control" class="form-group">
        <label for="free-shapes-rotation" class="vscode-label mb-1">Rotation (deg):</label>
        <input
          id="free-shapes-rotation"
          type="number"
          min="-360"
          max="360"
          step="1"
          class="input-field w-full"
        />
      </div>

      <!-- Quick Actions -->
      <div class="flex flex-wrap items-center gap-2">
        <button id="free-shapes-transparent-btn" class="btn btn-small btn-outlined">
          Transparent Fill
        </button>
        <button id="free-shapes-no-border-btn" class="btn btn-small btn-outlined">No Border</button>
      </div>
    </div>
  </div>

  <!-- Footer with buttons (same style as editor-footer-template) -->
  <div
    id="panel-free-shapes-footer"
    class="panel-block flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--vscode-panel-border)] bg-[var(--vscode-sideBar-background)] flex-shrink-0"
  >
    <button
      id="free-shapes-ok-btn"
      class="btn btn-primary btn-small"
      title="Apply changes and close"
    >
      OK
    </button>
    <button
      id="free-shapes-apply-btn"
      class="btn btn-outlined btn-small"
      title="Apply changes without closing"
    >
      Apply
    </button>
  </div>

  <script>
    (function () {
      const panel = document.getElementById("panel-free-shapes");
      const content = document.getElementById("panel-free-shapes-content");
      const footer = document.getElementById("panel-free-shapes-footer");

      function resizeContent() {
        if (!panel || !content || !footer) return;
        const panelRect = panel.getBoundingClientRect();
        const contentRect = content.getBoundingClientRect();
        const footerHeight = footer.getBoundingClientRect().height;

        const availableHeight = panelRect.height - (contentRect.top - panelRect.top) - footerHeight;

        if (availableHeight > 0) {
          content.style.height = `${availableHeight}px`;
        }
      }

      const resizeObserver = new ResizeObserver(() => {
        resizeContent();
      });

      resizeObserver.observe(panel);
      setTimeout(resizeContent, 100);
    })();
  </script>
</div>

      
      <!-- Unified Floating Action Panel -->
<style>
  /* Flip the deploy drawer based on panel half */
  #deploy-button-group.drawer-right #deploy-drawer {
    display: flex;
    flex-direction: row; /* default order */
    /* Keep a consistent 6px hover corridor on the right side */
    left: auto;
    right: auto;
    padding-left: calc(100% + 6px) !important;
    padding-right: 0 !important;
    transform: translateX(-0.5rem);
  }
  /* Activate drawer only when main button is hovered, or drawer itself is hovered */
  #deploy-button-group #deploy-destroy-btn:hover + #deploy-drawer,
  #deploy-button-group #deploy-drawer:hover,
  #deploy-button-group #deploy-destroy-btn:focus-visible + #deploy-drawer {
    opacity: 1 !important;
    transform: translateX(0) !important;
    pointer-events: auto !important;
  }

  #deploy-button-group.drawer-left #deploy-drawer {
    display: flex;
    flex-direction: row-reverse; /* mirror order */
    left: auto;
    right: 0; /* anchor to the right edge of the group */
    padding-right: calc(100% + 6px) !important; /* 6px hover corridor on left side */
    padding-left: 0 !important; /* neutralize base pl */
    transform: translateX(0.5rem); /* slide in from the left */
  }
  /* The above activation rule sets transform to 0 regardless of side */

  /* remove click-to-open; hover-only per main button */

  /* Shake animation for lock button when actions are blocked */
  @keyframes lock-shake {
    0%,
    100% {
      transform: translateX(0);
    }
    25% {
      transform: translateX(-3px);
    }
    75% {
      transform: translateX(3px);
    }
  }
  .lock-shake {
    animation: lock-shake 0.3s;
  }
</style>
<div
  id="unified-floating-panel"
  class="fixed bottom-5 left-5 z-[99999] bg-[var(--vscode-editor-background)] text-[var(--vscode-foreground)] rounded-md shadow-[0_4px_16px_var(--vscode-widget-shadow)] border border-[var(--vscode-panel-border)] p-2 flex flex-col gap-1 !w-[44px] !max-w-[44px] !min-w-[44px] cursor-grab select-none !box-border !shrink-0 !grow-0 overflow-visible"
>
  <!-- Drag Handle -->
  <div
    class="drag-handle w-full h-[4px] bg-[var(--vscode-panel-border)] rounded-[2px] -mt-[2px] mb-1 cursor-grab"
  ></div>

  <!-- Lock/Unlock Button -->
  <button
    id="lock-panel-btn"
    class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:-translate-y-[1px]"
    data-tippy-content="Lock Panel"
  >
    <i class="fas fa-lock text-[10px]"></i>
  </button>

  <!-- Panel Content -->
  <div id="panel-content" class="flex flex-col gap-1">
    <!-- Deploy/Destroy Button Group -->
    <div
      id="deploy-button-group"
      class="group relative flex items-center justify-start w-[28px] h-[28px] overflow-visible"
    >
      <!-- Main Deploy/Destroy Button -->
      <button
        id="deploy-destroy-btn"
        class="bg-[var(--vscode-button-background)] text-[var(--vscode-button-foreground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] relative z-50 hover:bg-[var(--vscode-button-hoverBackground)] hover:-translate-y-[1px]"
        data-tippy-content="Deploy Lab"
      >
        <i class="fas fa-play text-[10px]"></i>
      </button>

      <!-- Drawer with options -->
      <div
        id="deploy-drawer"
        class="absolute pl-[calc(100%+6px)] h-[32px] flex items-center gap-1 px-1 bg-none border border-none opacity-0 pointer-events-none transition-all ease-out duration-200 z-20"
      >
        <!-- Deploy (cleanup) - editor mode -->
        <button
          id="deploy-cleanup-btn"
          class="hidden bg-red-500 hover:bg-red-600 text-[var(--vscode-button-foreground)] border border-transparent rounded p-[6px] cursor-pointer items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:-translate-y-[1px]"
          data-tippy-content="Deploy (cleanup)"
        >
          <i class="fas fa-broom text-[10px]"></i>
        </button>
        <!-- Destroy (cleanup) - viewer mode -->
        <button
          id="destroy-cleanup-btn"
          class="hidden bg-red-500 hover:bg-red-600 text-[var(--vscode-button-foreground)] border border-transparent rounded p-[6px] cursor-pointer items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:-translate-y-[1px]"
          data-tippy-content="Destroy (cleanup)"
        >
          <i class="fas fa-broom text-[10px]"></i>
        </button>
        <!-- Redeploy - viewer mode -->
        <button
          id="redeploy-btn"
          class="hidden bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-foreground)] border border-transparent rounded p-[6px] cursor-pointer items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
          data-tippy-content="Redeploy"
        >
          <i class="fas fa-redo text-[10px]"></i>
        </button>
        <!-- Redeploy (cleanup) - viewer mode -->
        <button
          id="redeploy-cleanup-btn"
          class="hidden bg-red-500 hover:bg-red-600 text-[var(--vscode-button-foreground)] border border-transparent rounded p-[6px] cursor-pointer items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:-translate-y-[1px]"
          data-tippy-content="Redeploy (cleanup)"
        >
          <i class="fas fa-redo text-[10px]"></i>
        </button>
      </div>
    </div>

    <!-- Divider -->
    <div id="panel-divider-editor" class="h-px bg-[var(--vscode-panel-border)] my-[2px]"></div>

    <!-- Add Node Button -->
    <button
      id="add-node-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Add Node"
    >
      <i class="fas fa-plus text-[10px]"></i>
    </button>

    <!-- Add Network Button -->
    <button
      id="add-network-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Add Network"
    >
      <i class="fas fa-cloud text-[10px]"></i>
    </button>

    <!-- Add Group Button -->
    <button
      id="add-group-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Add Group"
    >
      <i class="fas fa-layer-group text-[10px]"></i>
    </button>

    <!-- Add Text Button -->
    <button
      id="add-text-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Add Text"
    >
      <i class="fas fa-font text-[10px]"></i>
    </button>

    <!-- Add Shapes Button -->
    <button
      id="add-shapes-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Add Shapes"
    >
      <i class="fas fa-shapes text-[10px]"></i>
    </button>

    <!-- Add Bulk Link Button -->
    <button
      id="add-bulk-link-btn"
      class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px] hover:bg-[var(--vscode-button-secondaryHoverBackground)] hover:-translate-y-[1px]"
      data-tippy-content="Bulk Link Devices"
    >
      <i class="fas fa-link text-[10px]"></i>
    </button>
  </div>
  <!-- End panel-content -->

  <!-- Collapse Control Section -->
  <div id="panel-divider-collapse" class="h-px bg-[var(--vscode-panel-border)] my-[2px]"></div>

  <!-- Collapse/Expand Button -->
  <button
    id="collapse-panel-btn"
    class="bg-[var(--vscode-button-secondaryBackground)] text-[var(--vscode-button-secondaryForeground)] border border-transparent rounded p-[6px] cursor-pointer flex items-center justify-center text-[12px] transition-all duration-150 w-[28px] h-[28px]"
    data-tippy-content="Collapse Panel"
  >
    <i class="fas fa-chevron-up text-[10px]"></i>
  </button>
</div>

<script>
  // Unified Floating Panel Event Handlers
  document.addEventListener("DOMContentLoaded", function () {
    const panel = document.getElementById("unified-floating-panel");
    const panelContent = document.getElementById("panel-content");
    const deployButtonGroup = document.getElementById("deploy-button-group");
    const lockBtn = document.getElementById("lock-panel-btn");
    const collapseBtn = document.getElementById("collapse-panel-btn");
    let isDragging = false;
    let startX, startY, initialLeft, initialTop;
    let isLocked = window.lockLabByDefault !== false;
    let isCollapsed = false;

    if (typeof window.lockLabByDefault !== "boolean") {
      window.lockLabByDefault = true;
    }

    // Initialize panel dimensions immediately to prevent sizing issues
    if (panel) {
      panel.style.setProperty("width", "44px", "important");
      panel.style.setProperty("max-width", "44px", "important");
      panel.style.setProperty("min-width", "44px", "important");
      panel.style.setProperty("min-height", "none", "important");
      panel.style.setProperty("max-height", "auto", "important");
      panel.style.setProperty("box-sizing", "border-box", "important");
      panel.style.overflow = "visible";

      // Force immediate layout
      panel.offsetWidth;
    }

    // Update drawer direction based on panel's horizontal position
    function updateDrawerDirection() {
      if (!panel || !deployButtonGroup) return;
      const rect = panel.getBoundingClientRect();
      const panelCenterX = rect.left + rect.width / 2;
      const viewportMidX = window.innerWidth / 2;
      if (panelCenterX > viewportMidX) {
        // Panel is on right half; open drawer to the left
        deployButtonGroup.classList.add("drawer-left");
        deployButtonGroup.classList.remove("drawer-right");
      } else {
        // Panel is on left half; open drawer to the right
        deployButtonGroup.classList.add("drawer-right");
        deployButtonGroup.classList.remove("drawer-left");
      }
    }

    // Load saved state from localStorage
    function loadPanelState() {
      const savedState = localStorage.getItem("unifiedPanelState");
      if (savedState && panel) {
        const state = JSON.parse(savedState);
        panel.style.inset = `${state.top}px auto auto ${state.left}px`;
        isCollapsed = state.collapsed || false;
      }
      // Apply configured default lock state regardless of saved state
      isLocked = window.lockLabByDefault !== false;
      updateLockState();
      updateCollapseState();
      updateDrawerDirection();
    }

    // Save panel state to localStorage
    function savePanelState() {
      if (panel) {
        const rect = panel.getBoundingClientRect();
        const state = {
          left: rect.left,
          top: rect.top,
          locked: isLocked,
          collapsed: isCollapsed
        };
        localStorage.setItem("unifiedPanelState", JSON.stringify(state));
      }
    }

    // Update lock button and panel cursor
    function updateLockState() {
      const lockBtnRef = document.getElementById("lock-panel-btn");
      if (!lockBtnRef || !panel) return;

      const buttonsToToggle = [
        "add-node-btn",
        "add-network-btn",
        "add-group-btn",
        "add-text-btn",
        "add-shapes-btn",
        "add-bulk-link-btn",
        "collapse-panel-btn",
        "viewport-lab-settings",
        "viewport-layout"
      ];
      buttonsToToggle.forEach((id) => {
        const btn = document.getElementById(id);
        if (btn) {
          if (isLocked) {
            btn.setAttribute("disabled", "true");
            btn.style.opacity = "0.5";
            btn.classList.remove("cursor-pointer");
            btn.classList.add("cursor-not-allowed");
          } else {
            btn.removeAttribute("disabled");
            btn.style.opacity = "1";
            btn.classList.add("cursor-pointer");
            btn.classList.remove("cursor-not-allowed");
          }
        }
      });

      if (isLocked) {
        lockBtnRef.innerHTML = '<i class="fas fa-lock text-[10px]"></i>';
        lockBtnRef.setAttribute("data-tippy-content", "Unlock Lab");
        lockBtnRef.style.background = "var(--color-red-500)";
        lockBtnRef.style.color = "var(--vscode-button-foreground)";
        if (lockBtnRef._tippy) {
          lockBtnRef._tippy.setContent("Unlock Lab");
        }

        panel.style.cursor = "default";
        const dragHandle = panel.querySelector(".drag-handle");
        if (dragHandle) dragHandle.style.cursor = "default";
      } else {
        lockBtnRef.innerHTML = '<i class="fas fa-unlock text-[10px]"></i>';
        lockBtnRef.setAttribute("data-tippy-content", "Lock Lab");
        lockBtnRef.style.background = "var(--vscode-button-secondaryBackground)";
        lockBtnRef.style.color = "var(--vscode-button-secondaryForeground)";
        if (lockBtnRef._tippy) {
          lockBtnRef._tippy.setContent("Lock Lab");
        }

        panel.style.cursor = "grab";
        const dragHandle = panel.querySelector(".drag-handle");
        if (dragHandle) dragHandle.style.cursor = "grab";
      }

      // Notify other scripts about lock state changes
      window.topologyLocked = isLocked;
      window.dispatchEvent(new CustomEvent("topology-lock-change", { detail: isLocked }));
    }

    // Update collapse button and panel content visibility
    function updateCollapseState() {
      const collapseBtnRef = document.getElementById("collapse-panel-btn");
      if (!collapseBtnRef || !panelContent) return;

      if (isCollapsed) {
        collapseBtnRef.innerHTML = '<i class="fas fa-chevron-down text-[10px]"></i>';
        collapseBtnRef.setAttribute("data-tippy-content", "Expand Panel");
        if (collapseBtnRef._tippy) {
          collapseBtnRef._tippy.setContent("Expand Panel");
        }
        panelContent.style.display = "none";
        // Also hide the bottom divider
        const divider = document.getElementById("panel-divider-collapse");
        if (divider) divider.style.display = "none";
      } else {
        collapseBtnRef.innerHTML = '<i class="fas fa-chevron-up text-[10px]"></i>';
        collapseBtnRef.setAttribute("data-tippy-content", "Collapse Panel");
        if (collapseBtnRef._tippy) {
          collapseBtnRef._tippy.setContent("Collapse Panel");
        }
        panelContent.style.display = "flex";
        // Show the bottom divider
        const divider = document.getElementById("panel-divider-collapse");
        if (divider) divider.style.display = "block";
      }
    }

    // Briefly shake the lock button to indicate actions are blocked
    function showLockedMessage() {
      const lockBtn = document.getElementById("lock-panel-btn");
      if (!lockBtn) return;
      lockBtn.classList.add("lock-shake");
      lockBtn.addEventListener("animationend", () => lockBtn.classList.remove("lock-shake"), {
        once: true
      });
    }
    window.showLabLockedMessage = showLockedMessage;

    // Initialize drag functionality
    function initializeDrag() {
      if (!panel) return;

      // Load saved state
      loadPanelState();

      // Mouse down on panel (start drag)
      panel.addEventListener("mousedown", function (e) {
        // Don't drag if locked or clicking on buttons
        if (isLocked || e.target.tagName === "BUTTON" || e.target.tagName === "I") {
          return;
        }

        // Only start drag if clicking on panel background or drag handle
        if (
          !e.target.classList.contains("drag-handle") &&
          e.target !== panel &&
          !panel.contains(e.target)
        ) {
          return;
        }

        isDragging = true;
        panel.style.cursor = "grabbing";
        const dragHandle = panel.querySelector(".drag-handle");
        if (dragHandle) dragHandle.style.cursor = "grabbing";

        const rect = panel.getBoundingClientRect();
        startX = e.clientX;
        startY = e.clientY;
        initialLeft = rect.left;
        initialTop = rect.top;

        e.preventDefault();
      });

      // Mouse move (drag)
      document.addEventListener("mousemove", function (e) {
        if (!isDragging || isLocked) return;

        const deltaX = e.clientX - startX;
        const deltaY = e.clientY - startY;

        let newLeft = initialLeft + deltaX;
        let newTop = initialTop + deltaY;

        // Keep panel within viewport bounds (respect navbar boundaries)
        const panelRect = panel.getBoundingClientRect();
        const navbar = document.querySelector(".navbar");
        const navbarHeight = navbar ? navbar.offsetHeight : 72; // Default to 72px if not found
        const maxLeft = window.innerWidth - panelRect.width;
        const maxTop = window.innerHeight - panelRect.height;
        const minTop = navbarHeight; // Can't go above navbar

        newLeft = Math.max(0, Math.min(newLeft, maxLeft));
        newTop = Math.max(minTop, Math.min(newTop, maxTop));

        panel.style.left = newLeft + "px";
        panel.style.top = newTop + "px";
        panel.style.bottom = "auto";
        panel.style.right = "auto";
        updateDrawerDirection();
      });

      // Mouse up (end drag)
      document.addEventListener("mouseup", function () {
        if (isDragging) {
          isDragging = false;
          updateLockState(); // This will restore proper cursor
          savePanelState();
          updateDrawerDirection();
        }
      });

      // Event listeners are now handled in setupControlButtons()
    }

    // Get current viewer mode state
    function isViewerMode() {
      return (
        window.topoViewerMode === "viewer" ||
        (window.topoViewerState && window.topoViewerState.currentMode === "viewer")
      );
    }

    // Update panel state based on current mode
    function updateUnifiedPanelState() {
      const deployBtn = document.getElementById("deploy-destroy-btn");
      const redeployBtn = document.getElementById("redeploy-btn");
      const deployCleanupBtn = document.getElementById("deploy-cleanup-btn");
      const destroyCleanupBtn = document.getElementById("destroy-cleanup-btn");
      const redeployCleanupBtn = document.getElementById("redeploy-cleanup-btn");
      const addNodeBtn = document.getElementById("add-node-btn");
      const addNetworkBtn = document.getElementById("add-network-btn");
      const addGroupBtn = document.getElementById("add-group-btn");
      const addTextBtn = document.getElementById("add-text-btn");

      if (deployBtn && redeployBtn) {
        if (isViewerMode()) {
          // In viewer mode (lab is running), show destroy button and redeploy button
          deployBtn.innerHTML = '<i class="fas fa-stop text-[10px]"></i>';
          deployBtn.setAttribute("data-tippy-content", "Destroy Lab");
          deployBtn.style.background = "var(--vscode-button-background)";
          deployBtn.style.color = "var(--vscode-button-foreground)";
          deployBtn.onmouseover = function () {
            this.style.background = "var(--vscode-button-hoverBackground)";
            this.style.transform = "translateY(-1px)";
            this.style.opacity = "1";
          };
          deployBtn.onmouseout = function () {
            this.style.background = "var(--vscode-button-background)";
            this.style.transform = "translateY(0)";
            this.style.opacity = "1";
          };

          // Show viewer-mode buttons
          if (redeployBtn) {
            redeployBtn.classList.remove("hidden");
            redeployBtn.classList.add("flex");
          }
          if (destroyCleanupBtn) {
            destroyCleanupBtn.classList.remove("hidden");
            destroyCleanupBtn.classList.add("flex");
          }
          if (redeployCleanupBtn) {
            redeployCleanupBtn.classList.remove("hidden");
            redeployCleanupBtn.classList.add("flex");
          }
          if (deployCleanupBtn) {
            deployCleanupBtn.classList.add("hidden");
            deployCleanupBtn.classList.remove("flex");
          }
        } else {
          // In editor mode (lab is not running), show deploy button and hide redeploy button
          deployBtn.innerHTML = '<i class="fas fa-play text-[10px]"></i>';
          deployBtn.setAttribute("data-tippy-content", "Deploy Lab");
          deployBtn.style.background = "var(--vscode-button-background)";
          deployBtn.style.color = "var(--vscode-button-foreground)";
          deployBtn.onmouseover = function () {
            this.style.background = "var(--vscode-button-hoverBackground)";
            this.style.transform = "translateY(-1px)";
            this.style.opacity = "1";
          };
          deployBtn.onmouseout = function () {
            this.style.background = "var(--vscode-button-background)";
            this.style.transform = "translateY(0)";
            this.style.opacity = "1";
          };

          // Editor-mode visibility
          if (redeployBtn) {
            redeployBtn.classList.add("hidden");
            redeployBtn.classList.remove("flex");
          }
          if (destroyCleanupBtn) {
            destroyCleanupBtn.classList.add("hidden");
            destroyCleanupBtn.classList.remove("flex");
          }
          if (redeployCleanupBtn) {
            redeployCleanupBtn.classList.add("hidden");
            redeployCleanupBtn.classList.remove("flex");
          }
          if (deployCleanupBtn) {
            deployCleanupBtn.classList.remove("hidden");
            deployCleanupBtn.classList.add("flex");
          }
        }
      }

      // Editor-only tools (only visible in editor mode)
      const addBulkLinkBtn = document.getElementById("add-bulk-link-btn");
      const editorOnlyButtons = [addNodeBtn, addNetworkBtn, addBulkLinkBtn];
      editorOnlyButtons.forEach((btn) => {
        if (btn) {
          btn.style.display = isViewerMode() ? "none" : "flex";
        }
      });

      // Add group and add text are available in both modes
      if (addGroupBtn) {
        addGroupBtn.style.display = "flex";
      }
      if (addTextBtn) {
        addTextBtn.style.display = "flex";
      }
    }

    // Initialize panel dimensions and state
    function initializePanel() {
      if (panel) {
        // Ensure consistent panel size with more specific constraints
        panel.style.setProperty("width", "44px", "important");
        panel.style.setProperty("max-width", "44px", "important");
        panel.style.setProperty("min-width", "44px", "important");
        panel.style.setProperty("min-height", "none", "important");
        panel.style.setProperty("max-height", "auto", "important");
        panel.style.setProperty("box-sizing", "border-box", "important");

        // Ensure proper height constraints
        panel.style.height = "auto";
        panel.style.maxHeight = "none";
        panel.style.minHeight = "auto";

        // Force layout recalculation immediately
        panel.offsetWidth;
        panel.offsetHeight;

        // Double-check and reapply if needed
        setTimeout(() => {
          if (panel.offsetWidth !== 44) {
            panel.style.setProperty("width", "44px", "important");
            panel.style.setProperty("max-width", "44px", "important");
            panel.style.setProperty("min-width", "44px", "important");
          }
        }, 0);
      }
    }

    // Setup deploy button group expansion
    function setupDeployButtonExpansion() {
      const deployButtonGroup = document.getElementById("deploy-button-group");
      const deployMainBtn = document.getElementById("deploy-destroy-btn");
      const secondaryButtons = document.getElementById("deploy-secondary-buttons");
      const redeployBtn = document.getElementById("redeploy-btn");
      const cleanupBtn = document.getElementById("cleanup-action-btn");

      let hoverTimeout;
      let isExpanded = false;

      function showSecondaryButtons() {
        if (!secondaryButtons) return;

        clearTimeout(hoverTimeout);
        isExpanded = true;

        secondaryButtons.style.opacity = "1";
        secondaryButtons.style.visibility = "visible";
        secondaryButtons.style.pointerEvents = "auto";

        // Show appropriate secondary buttons based on mode
        if (isViewerMode()) {
          if (redeployBtn && redeployBtn.style.display !== "none") {
            redeployBtn.style.opacity = "1";
            redeployBtn.style.transform = "translateX(0)";
          }
        }
        if (cleanupBtn) {
          cleanupBtn.style.opacity = "1";
          cleanupBtn.style.transform = "translateX(0)";
        }
      }

      function hideSecondaryButtons() {
        if (!secondaryButtons) return;

        hoverTimeout = setTimeout(() => {
          if (!isExpanded) return;

          isExpanded = false;
          secondaryButtons.style.opacity = "0";
          secondaryButtons.style.visibility = "hidden";
          secondaryButtons.style.pointerEvents = "none";

          // Hide secondary buttons
          if (redeployBtn) {
            redeployBtn.style.opacity = "0";
            redeployBtn.style.transform = "translateX(-10px)";
          }
          if (cleanupBtn) {
            cleanupBtn.style.opacity = "0";
            cleanupBtn.style.transform = "translateX(-10px)";
          }
        }, 150);
      }

      // Add hover listeners to the button group
      if (deployButtonGroup) {
        deployButtonGroup.addEventListener("mouseenter", showSecondaryButtons);
        deployButtonGroup.addEventListener("mouseleave", hideSecondaryButtons);
      }
    }

    // Add event listeners for control buttons
    function setupControlButtons() {
      const lockBtn = document.getElementById("lock-panel-btn");
      const collapseBtn = document.getElementById("collapse-panel-btn");

      if (lockBtn) {
        lockBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          isLocked = !isLocked;
          updateLockState();
          savePanelState();
          // Re-enforce panel size after state change
          initializePanel();
        });

        // Add hover effects
        lockBtn.addEventListener("mouseenter", function () {
          if (isLocked) {
            this.style.background = "var(--color-red-600)";
          } else {
            this.style.background = "var(--vscode-button-secondaryHoverBackground)";
          }
          this.style.transform = "translateY(-1px)";
        });

        lockBtn.addEventListener("mouseleave", function () {
          if (isLocked) {
            this.style.opacity = "1";
            this.style.background = "var(--color-red-500)";
          } else {
            this.style.background = "var(--vscode-button-secondaryBackground)";
          }
          this.style.transform = "translateY(0)";
        });
      }

      if (collapseBtn) {
        collapseBtn.addEventListener("click", function (e) {
          e.stopPropagation();
          isCollapsed = !isCollapsed;
          updateCollapseState();
          savePanelState();
          // Re-enforce panel size after state change
          setTimeout(initializePanel, 0);
        });

        // Add hover effects
        collapseBtn.addEventListener("mouseenter", function () {
          this.style.background =
            "var(--vscode-button-secondaryHoverBackground, rgba(90, 93, 94, 0.51))";
          this.style.transform = "translateY(-1px)";
        });

        collapseBtn.addEventListener("mouseleave", function () {
          this.style.background =
            "var(--vscode-button-secondaryBackground, rgba(90, 93, 94, 0.31))";
          this.style.transform = "translateY(0)";
        });
      }

      // Mouse leave window (stop drag to prevent jumping)
      document.addEventListener("mouseleave", function () {
        if (isDragging) {
          isDragging = false;
          updateLockState();
          savePanelState();
          updateDrawerDirection();
        }
      });

      // Visibility change (stop drag when tab becomes hidden)
      document.addEventListener("visibilitychange", function () {
        if (document.hidden && isDragging) {
          isDragging = false;
          updateLockState();
          savePanelState();
          updateDrawerDirection();
        }
      });

      // Window blur (stop drag when window loses focus)
      window.addEventListener("blur", function () {
        if (isDragging) {
          isDragging = false;
          updateLockState();
          savePanelState();
          updateDrawerDirection();
        }
      });
    }

    // Initialize everything
    initializePanel();
    initializeDrag();
    setupControlButtons();
    updateUnifiedPanelState();
    updateDrawerDirection();

    // Make function globally available for TypeScript manager
    window.updateUnifiedPanelState = updateUnifiedPanelState;

    // Add event listeners for all buttons
    const deployBtn = document.getElementById("deploy-destroy-btn");
    const redeployBtn = document.getElementById("redeploy-btn");
    const cleanupBtn = document.getElementById("cleanup-action-btn");
    const addNodeBtn = document.getElementById("add-node-btn");
    const addNetworkBtn = document.getElementById("add-network-btn");
    const addGroupBtn = document.getElementById("add-group-btn");
    const addTextBtn = document.getElementById("add-text-btn");
    const addShapesBtn = document.getElementById("add-shapes-btn");
    const addBulkLinkBtn = document.getElementById("add-bulk-link-btn");

    if (deployBtn) {
      deployBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-deploy-destroy-click", {
          detail: { isViewerMode: isViewerMode() }
        });
        document.dispatchEvent(event);
      });
    }

    if (redeployBtn) {
      redeployBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-redeploy-click", {
          detail: { isViewerMode: isViewerMode() }
        });
        document.dispatchEvent(event);
      });
    }

    if (cleanupBtn) {
      cleanupBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-cleanup-click", {
          detail: { isViewerMode: isViewerMode() }
        });
        document.dispatchEvent(event);
      });
    }

    if (addNodeBtn) {
      addNodeBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-node-click");
        document.dispatchEvent(event);
      });
    }

    if (addNetworkBtn) {
      addNetworkBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-network-click");
        document.dispatchEvent(event);
      });
    }

    if (addGroupBtn) {
      addGroupBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-group-click");
        document.dispatchEvent(event);
      });
    }

    if (addTextBtn) {
      addTextBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-text-click");
        document.dispatchEvent(event);
      });
    }

    if (addShapesBtn) {
      addShapesBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-shapes-click");
        document.dispatchEvent(event);
      });
    }

    if (addBulkLinkBtn) {
      addBulkLinkBtn.addEventListener("click", function (e) {
        e.stopPropagation();
        const event = new CustomEvent("unified-add-bulk-link-click");
        document.dispatchEvent(event);
      });
    }

    // Listen for mode changes
    document.addEventListener("topo-mode-changed", updateUnifiedPanelState);

    // Handle window resize to keep panel in bounds
    window.addEventListener("resize", function () {
      if (panel && window.keepPanelWithinBounds) {
        const result = window.keepPanelWithinBounds(panel);
        if (result.changed) {
          savePanelState();
        }
      }
      updateDrawerDirection();
    });
  });
</script>

      <!-- Reusable Confirm Dialog -->
<div id="confirm-dialog-backdrop" class="modal-backdrop" style="display: none">
  <div id="confirm-dialog" class="modal-content p-6 rounded-lg max-w-md">
    <!-- Icon Container -->
    <div id="confirm-dialog-icon" class="flex justify-center mb-4" style="display: none">
      <i id="confirm-dialog-icon-element" class="text-4xl"></i>
    </div>

    <!-- Title -->
    <h3 id="confirm-dialog-title" class="text-lg font-semibold text-center mb-2">Confirm Action</h3>

    <!-- Message -->
    <p id="confirm-dialog-message" class="text-sm text-center mb-6 text-secondary">
      Are you sure you want to proceed?
    </p>

    <!-- Buttons Container -->
    <div id="confirm-dialog-buttons" class="flex justify-center gap-3">
      <button id="confirm-dialog-cancel" class="btn btn-secondary">Cancel</button>
      <button id="confirm-dialog-confirm" class="btn btn-primary">Confirm</button>
    </div>
  </div>
</div>

<script>
  (function () {
    "use strict";

    let confirmResolve = null;
    let isDialogOpen = false;

    const backdrop = document.getElementById("confirm-dialog-backdrop");
    const dialog = document.getElementById("confirm-dialog");
    const iconContainer = document.getElementById("confirm-dialog-icon");
    const iconElement = document.getElementById("confirm-dialog-icon-element");
    const titleElement = document.getElementById("confirm-dialog-title");
    const messageElement = document.getElementById("confirm-dialog-message");
    const cancelButton = document.getElementById("confirm-dialog-cancel");
    const confirmButton = document.getElementById("confirm-dialog-confirm");

    function closeDialog(result) {
      if (!isDialogOpen) return;

      isDialogOpen = false;
      backdrop.style.display = "none";
      document.removeEventListener("keydown", handleKeydown);

      if (confirmResolve) {
        confirmResolve(result);
        confirmResolve = null;
      }
    }

    function handleKeydown(event) {
      if (!isDialogOpen) return;

      if (event.key === "Escape") {
        event.preventDefault();
        closeDialog(false);
      } else if (event.key === "Enter") {
        event.preventDefault();
        closeDialog(true);
      }
    }

    // Show confirmation dialog
    window.showConfirmDialog = function (options = {}) {
      return new Promise((resolve) => {
        if (isDialogOpen) {
          resolve(false);
          return;
        }

        confirmResolve = resolve;
        isDialogOpen = true;

        // Set title
        titleElement.textContent = options.title || "Confirm Action";

        // Set message
        messageElement.textContent = options.message || "Are you sure you want to proceed?";

        // Set icon
        if (options.icon) {
          iconElement.className = `text-4xl ${options.icon}`;
          iconContainer.style.display = "flex";
        } else {
          iconContainer.style.display = "none";
        }

        // Set button texts and styles
        const cancelText = options.cancelText || "Cancel";
        const confirmText = options.confirmText || "Confirm";
        const confirmStyle = options.confirmStyle || "btn-primary";

        cancelButton.textContent = cancelText;
        confirmButton.textContent = confirmText;

        // Reset button classes and apply new style
        confirmButton.className = `btn ${confirmStyle}`;

        // Show dialog
        backdrop.style.display = "flex";

        // Focus default button
        if (options.focusCancel) {
          cancelButton.focus();
        } else {
          confirmButton.focus();
        }

        // Add keyboard listener
        document.addEventListener("keydown", handleKeydown);
      });
    };

    // Predefined dialog types for common actions
    window.showDeleteConfirm = function (itemName, count = 1) {
      const message =
        count > 1
          ? `Are you sure you want to delete ${count} selected items?`
          : itemName
            ? `Are you sure you want to delete "${itemName}"?`
            : "Are you sure you want to delete this item?";

      return window.showConfirmDialog({
        title: "Confirm Deletion",
        message: message,
        icon: "fas fa-exclamation-triangle text-yellow-500",
        confirmText: "Delete",
        confirmStyle: "btn-danger",
        cancelText: "Cancel (esc)",
        focusCancel: true
      });
    };

    window.showBulkActionConfirm = function (
      actionName,
      sourcePattern,
      targetPattern,
      estimatedCount = null
    ) {
      let message = `Create links between devices matching "${sourcePattern}" and "${targetPattern}"?`;
      if (estimatedCount) {
        message += ` This will create approximately ${estimatedCount} links.`;
      }

      return window.showConfirmDialog({
        title: `Confirm ${actionName}`,
        message: message,
        icon: "fas fa-link text-blue-500",
        confirmText: "Create Links",
        confirmStyle: "btn-primary",
        cancelText: "Cancel (esc)"
      });
    };

    // Event listeners for buttons
    cancelButton.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      closeDialog(false);
    });

    confirmButton.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      closeDialog(true);
    });

    // Click outside to cancel
    backdrop.addEventListener("click", function (e) {
      if (e.target === backdrop) {
        closeDialog(false);
      }
    });
  })();

  // Global panel keyboard handler for ESC/ENTER functionality
  (function () {
    "use strict";

    // Global keyboard handler for all panels
    function handleGlobalPanelKeys(event) {
      // Skip if confirm dialog is open
      const confirmBackdrop = document.getElementById("confirm-dialog-backdrop");
      if (confirmBackdrop && confirmBackdrop.style.display !== "none") {
        return;
      }

      // Find currently visible panel
      const visiblePanel = findVisiblePanel();
      if (!visiblePanel) {
        return;
      }

      if (event.key === "Escape") {
        // ESC always closes the panel
        event.preventDefault();
        closePanel(visiblePanel);
      } else if (event.key === "Enter") {
        // ENTER works for form submission
        event.preventDefault();
        triggerPrimaryAction(visiblePanel);
      }
    }

    // Find the currently visible panel
    function findVisiblePanel() {
      const panelSelectors = [
        "#panel-bulk-link",
        "#panel-node-editor-parent",
        "#panel-topoviewer-about",
        "#panel-network-editor",
        "#panel-lab-settings",
        "#panel-node-editor",
        "#panel-link-editor",
        "#panel-link",
        "#panel-node",
        "#viewport-drawer-topology-overview",
        "#viewport-drawer-capture-sceenshoot",
        "#viewport-drawer-layout",
        "#shortcuts-panel"
      ];

      for (const selector of panelSelectors) {
        const panel = document.querySelector(selector);
        if (panel && panel.style.display === "block") {
          return panel;
        }
      }
      return null;
    }

    // Close a panel
    function closePanel(panel) {
      panel.style.display = "none";

      // For viewport drawers, also hide all other drawers
      if (panel.id.startsWith("viewport-drawer-")) {
        const viewportDrawers = document.getElementsByClassName("viewport-drawer");
        for (let i = 0; i < viewportDrawers.length; i++) {
          viewportDrawers[i].style.display = "none";
        }
      }
    }

    // Trigger the primary action button in a panel
    function triggerPrimaryAction(panel) {
      console.log("triggerPrimaryAction called for panel:", panel.id);

      // First try specific known button IDs for each panel
      const panelSpecificButtons = {
        "panel-bulk-link": "#bulk-link-apply",
        "panel-node-editor": "#panel-node-editor-save-button",
        "panel-node-editor-parent": 'button[onclick*="nodeParentPropertiesUpdate()"]',
        "panel-link-editor": "#panel-link-editor-save-button",
        "panel-network-editor": 'button[onclick*="Apply"]'
      };

      const panelId = panel.id;
      if (panelSpecificButtons[panelId]) {
        const selector = panelSpecificButtons[panelId];
        const button = panel.querySelector(selector);
        console.log("Specific selector for", panelId, ":", selector);
        console.log("Found button:", button);
        if (button && !button.disabled && button.style.display !== "none") {
          console.log("Clicking specific button:", button.textContent.trim());
          button.click();
          return;
        }
      }

      // Look for common primary action buttons (in order of preference)
      const primaryButtonSelectors = [
        '.btn-primary:not([style*="display: none"])',
        'button[id*="apply"]:not([style*="display: none"])',
        'button[id*="save"]:not([style*="display: none"])',
        'button[id*="update"]:not([style*="display: none"])',
        'button[onclick*="Apply"]:not([style*="display: none"])',
        'button[onclick*="Update"]:not([style*="display: none"])',
        'button[onclick*="Save"]:not([style*="display: none"])',
        'button[type="submit"]:not([style*="display: none"])'
      ];

      console.log("Trying fallback selectors...");
      for (const selector of primaryButtonSelectors) {
        const button = panel.querySelector(selector);
        console.log("Selector:", selector, "found:", button);
        if (button && !button.disabled) {
          console.log("Clicking fallback button:", button.textContent.trim());
          button.click();
          return;
        }
      }

      // Final fallback: find any visible button that looks like a primary action
      console.log("Trying final fallback...");
      const buttons = panel.querySelectorAll(
        'button:not(.btn-secondary):not(.btn-danger):not([id*="cancel"]):not([id*="close"])'
      );
      console.log("Final fallback buttons found:", buttons.length);
      for (const button of buttons) {
        console.log(
          "Final fallback button:",
          button.textContent.trim(),
          "disabled:",
          button.disabled,
          "display:",
          button.style.display
        );
        if (!button.disabled && button.style.display !== "none") {
          console.log("Clicking final fallback button:", button.textContent.trim());
          button.click();
          return;
        }
      }
      console.log("No button found for ENTER action");
    }

    // Add global event listener
    document.addEventListener("keydown", handleGlobalPanelKeys);
  })();
</script>

      <!-- Shortcuts Panel -->
<aside
  class="panel viewport-drawer fixed top-[4.5rem] right-[1rem] w-100 z-[30] max-h-[calc(100vh-5rem)]"
  id="shortcuts-panel"
  style="display: none"
>
  <header class="panel-heading flex-shrink-0">
    <i class="fas fa-keyboard mr-2"></i>
    Shortcuts & Interactions
  </header>

  <div
    class="p-4 space-y-4 overflow-y-auto overflow-x-hidden flex-1 min-h-0"
    style="max-height: calc(100vh - 8rem); scrollbar-width: thin"
  >
    <!-- Viewer Mode -->
    <section>
      <h4 class="font-semibold text-green-600 mb-2">
        <i class="fas fa-eye"></i>
        Viewer Mode
      </h4>
      <div class="space-y-1">
        <div class="flex justify-between">
          <span>Select node/link</span>
          <kbd>Left Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Node actions</span>
          <kbd>Right Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Capture packets</span>
          <kbd>Right Click + Link</kbd>
        </div>
        <div class="flex justify-between">
          <span>Move nodes</span>
          <kbd>Drag</kbd>
        </div>
        <div class="flex justify-between">
          <span>Quick Item Search</span>
          <kbd>Ctrl + F</kbd>
        </div>
      </div>
    </section>

    <!-- Editor Mode -->
    <section>
      <h4 class="font-semibold text-blue-600 mb-2">
        <i class="fas fa-edit"></i>
        Editor Mode
      </h4>
      <div class="space-y-1">
        <div class="flex justify-between">
          <span>Add node</span>
          <kbd>Shift + Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Create link</span>
          <kbd>Shift + Node</kbd>
        </div>
        <div class="flex justify-between">
          <span>Delete</span>
          <kbd>Alt + Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Release from group</span>
          <kbd>Ctrl + Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Context menu</span>
          <kbd>Right Click</kbd>
        </div>
        <div class="flex justify-between">
          <span>Select all</span>
          <kbd>Ctrl + A</kbd>
        </div>
        <div class="flex justify-between">
          <span>Copy selected</span>
          <kbd>Ctrl + C</kbd>
        </div>
        <div class="flex justify-between">
          <span>Paste</span>
          <kbd>Ctrl + V</kbd>
        </div>
        <div class="flex justify-between">
          <span>Cut selected</span>
          <kbd>Ctrl + X</kbd>
        </div>
        <div class="flex justify-between">
          <span>Duplicate selected</span>
          <kbd>Ctrl + D</kbd>
        </div>
        <div class="flex justify-between">
          <span>Create group (also via selection)</span>
          <kbd>G</kbd>
        </div>
        <div class="flex justify-between">
          <span>Delete selected</span>
          <kbd>Del</kbd>
        </div>
      </div>
    </section>

    <!-- Panel Controls -->
    <section>
      <h4 class="font-semibold text-purple-600 mb-2">
        <i class="fas fa-cog"></i>
        Panel Controls
      </h4>
      <div class="space-y-1">
        <div class="flex justify-between">
          <span>Close panel</span>
          <kbd>Esc</kbd>
        </div>
        <div class="flex justify-between">
          <span>Submit form</span>
          <kbd>Enter</kbd>
        </div>
      </div>
    </section>

    <!-- Tips -->
    <section>
      <h4 class="font-semibold text-orange-600 mb-2">
        <i class="fas fa-lightbulb"></i>
        Tips
      </h4>
      <ul class="list-disc list-inside text-secondary space-y-1">
        <li>Use layout algorithms to auto-arrange</li>
        <li>
          Box Selection with
          <kbd>Shift</kbd>
          +
          <kbd>Click</kbd>
          and press
          <kbd>G</kbd>
          to group or
          <kbd>Del</kbd>
          to delete
        </li>
        <li>Double-click any item to directly edit</li>
        <li>Export as image from context menu</li>
      </ul>
    </section>
  </div>
</aside>

<script>
  window.showShortcutsModal = function () {
    const panel = document.getElementById("shortcuts-panel");
    if (panel) {
      // Toggle the panel visibility
      if (panel.style.display === "block") {
        panel.style.display = "none";
      } else {
        // Hide other panels first
        const aboutPanel = document.getElementById("panel-topoviewer-about");
        if (aboutPanel) aboutPanel.style.display = "none";
        // Show shortcuts panel
        panel.style.display = "block";
      }
    }
  };
  (function () {
    const isMac = navigator.platform.toUpperCase().indexOf("MAC") >= 0;
    if (isMac) {
      document.querySelectorAll("kbd").forEach((el) => {
        let text = el.textContent;
        text = text.replace(/Ctrl/g, "Cmd");
        text = text.replace(/Alt/g, "Option");
        el.textContent = text;
      });
    }
  })();
</script>

      
<script>
  window.schemaUrl = "/static/topoviewer/schema/clab.schema.json";
  window.imagesUrl = "/static/topoviewer/images";
  window.isVscodeDeployment = true;
  window.allowedHostname = "";
  window.topoViewerMode = "editor";
  window.currentLabPath = "";
  window.ifacePatternMapping = {};
  window.imageMapping = {};
  window.customIcons = {};
  window.dockerImages = [];
  window.defaultKind = "nokia_srlinux";
  window.defaultType = "ixr-d2l";
  window.customNodes = [];
  window.defaultNode = "";
  window.updateLinkEndpointsOnKindChange = true;
  window.lockLabByDefault = true;
  window.topologyDefaults = {};
  window.topologyKinds = {};
  window.topologyGroups = {};
</script>

<template id="vars-section-template">
  <div class="form-group">
    <label class="block vscode-label mb-1">Vars</label>
    <div class="space-y-2 vars-container"></div>
    <button class="btn btn-small mt-2 add-var-btn">
      <i class="fas fa-plus mr-1"></i>
      Add Var
    </button>
  </div>
</template>

<template id="editor-footer-template">
  <div
    class="panel-block flex items-center justify-end gap-2 px-4 py-3 border-t border-[var(--vscode-panel-border)] bg-[var(--vscode-sideBar-background)]"
  >
    <button class="btn btn-primary btn-small editor-save-btn" title="Apply changes and close">
      OK
    </button>
    <button
      class="btn btn-outlined btn-small editor-apply-btn"
      title="Apply changes without closing"
    >
      Apply
    </button>
  </div>
</template>

<script>
  // Draggable Panels Manager with WindowManager Integration
  // Wait for the main bundle to load before initializing
  (function () {
    function initWindowManager() {
      // Wait for window manager to be available from the main bundle
      if (!window.panelManager || !window.windowManager) {
        // Retry in 50ms if not loaded yet
        setTimeout(initWindowManager, 50);
        return;
      }

      const { panelManager, windowManager, defaultPanelConfigs } = window;

      // Check if unified floating panel is locked
      function isUnifiedPanelLocked() {
        const savedState = localStorage.getItem("unifiedPanelState");
        if (savedState) {
          try {
            const state = JSON.parse(savedState);
            return state.locked || false;
          } catch (e) {
            console.warn("Failed to parse unified panel state:", e);
          }
        }
        return false;
      }

      // Get navbar height to calculate proper bounds
      function getNavbarHeight() {
        const navbar = document.querySelector(".navbar");
        return navbar ? navbar.offsetHeight : 72; // Default to 72px (4.5rem) if not found
      }

      // Initialize all draggable panels with window manager
      function initializeAllDraggablePanels() {
        const draggablePanels = document.querySelectorAll(".draggable-panel");
        const navbarHeight = getNavbarHeight();

        draggablePanels.forEach((panel) => {
          const panelId = panel.id;

          // Skip unified floating panel (it has its own management)
          if (panelId === "unified-floating-panel") {
            return;
          }

          // Skip if already registered
          if (panelManager.getPanel(panelId)) {
            console.log(`Panel ${panelId} already registered, skipping`);
            return;
          }

          // Find matching config
          const config = defaultPanelConfigs.find((c) => c.id === panelId);

          if (config) {
            // Register with window manager
            const managedWindow = panelManager.registerPanel({
              ...config,
              element: panel,
              defaultX: config.defaultX ?? 100,
              defaultY: config.defaultY ?? navbarHeight + 20
            });

            console.log(`Registered panel: ${panelId}`, managedWindow);

            // Update draggability based on lock state
            if (managedWindow && isUnifiedPanelLocked()) {
              managedWindow.config.draggable = false;
            }
          } else {
            // Panel not in default configs, create basic config
            const managedWindow = panelManager.registerPanel({
              id: panelId,
              element: panel,
              defaultX: 100,
              defaultY: navbarHeight + 20,
              defaultWidth: 400,
              defaultHeight: 500,
              persistState: true
            });
            console.log(`Registered panel (generic): ${panelId}`, managedWindow);
          }
        });
      }

      // Update draggability of all panels based on lock state
      function updatePanelDraggability() {
        const locked = isUnifiedPanelLocked();
        panelManager.getAllPanels().forEach((win) => {
          win.config.draggable = !locked;

          // Update cursor on title bar
          const titleBar = win.element.querySelector(".panel-title-bar");
          if (titleBar) {
            titleBar.style.cursor = locked ? "default" : "move";
          }
        });
      }

      // Wire up close buttons for all panels
      function setupPanelCloseButtons() {
        document.querySelectorAll(".panel-close-btn").forEach((closeBtn) => {
          // Skip if already set up
          if (closeBtn.dataset.listenerAttached === "true") {
            return;
          }
          closeBtn.dataset.listenerAttached = "true";

          // Add click listener
          closeBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            const panel = closeBtn.closest(".draggable-panel");
            if (panel) {
              const managedWindow = panelManager.getPanel(panel.id);
              if (managedWindow) {
                managedWindow.close();
              } else {
                // Fallback for panels not managed by window manager
                panel.style.display = "none";
              }
            }
          });
        });
      }

      // Initial setup
      initializeAllDraggablePanels();
      setupPanelCloseButtons();
      updatePanelDraggability();

      // Listen for unified panel lock state changes
      let lastLockState = isUnifiedPanelLocked();
      setInterval(() => {
        const currentLockState = isUnifiedPanelLocked();
        if (currentLockState !== lastLockState) {
          lastLockState = currentLockState;
          updatePanelDraggability();
        }
      }, 100); // Check every 100ms

      // Re-initialize when DOM changes (for dynamically added panels)
      const mainObserver = new MutationObserver((mutations) => {
        const hasAddedNodes = mutations.some((mutation) => mutation.addedNodes.length > 0);
        if (hasAddedNodes) {
          initializeAllDraggablePanels();
          setupPanelCloseButtons();
        }
      });

      mainObserver.observe(document.body, {
        childList: true,
        subtree: true
      });

      console.log("Window Manager initialized successfully");
    }

    // Start initialization when DOM is ready
    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initWindowManager);
    } else {
      initWindowManager();
    }
  })();
</script>

<script>
  (function () {
    function ensureVscodeStub() {
      if (window.vscode && typeof window.vscode.postMessage === 'function') return;
      function respond(requestId, result, error) {
        window.postMessage(
          { type: 'POST_RESPONSE', requestId: requestId, result: result, error: error || undefined },
          window.location.origin
        );
      }
      function defaultResult(endpoint) {
        if (endpoint === 'lab-settings-get') return { settings: {} };
        if (endpoint === 'topo-editor-load-annotations') {
          return { groupStyles: [], freeTextAnnotations: [], freeShapeAnnotations: [], nodeAnnotations: [], cloudNodeAnnotations: [] };
        }
        if (endpoint === 'topo-editor-load-viewer-settings') return { settings: {} };
        return { success: true };
      }
      window.vscode = {
        postMessage: function (msg) {
          if (!msg || msg.type !== 'POST') return;
          const result = defaultResult(msg.endpointName);
          respond(msg.requestId, result, null);
        }
      };
    }

    function getCreds() {
      try {
        return JSON.parse(sessionStorage.getItem('clabCreds') || '{}');
      } catch (e) {
        return {};
      }
    }

    function buildFormData(lab, file) {
      const creds = getCreds();
      const fd = new FormData();
      fd.append('eve_ip', creds.eve_ip || '');
      fd.append('eve_user', creds.eve_user || '');
      fd.append('eve_pass', creds.eve_pass || '');
      fd.append('lab_name', lab || '');
      fd.append('path', file || '');
      const labsDir = sessionStorage.getItem('clabLabsDir') || '';
      if (labsDir) fd.append('labs_dir', labsDir);
      return fd;
    }

    function loadModule() {
      const script = document.createElement('script');
      script.type = 'module';
      script.src = '/static/topoviewer/topologyEditorWebviewController.js?v=2';
      document.body.appendChild(script);
    }

    const params = new URLSearchParams(window.location.search);
    const lab = params.get('lab') || '';
    const file = params.get('file') || '';
    if (!lab || !file) {
      document.body.innerHTML = '<div style="color:#e2e8f0;padding:20px;">Missing lab or file.</div>';
      return;
    }

    ensureVscodeStub();

    Promise.all([
      fetch('/api/container-labs/topoviewer/cyto', { method: 'POST', body: buildFormData(lab, file) }).then(r => r.json()),
      fetch('/api/container-labs/topoviewer/env', { method: 'POST', body: buildFormData(lab, file) }).then(r => r.json())
    ]).then(([cyto, env]) => {
      if (!cyto || cyto.success === false) {
        throw new Error((cyto && cyto.message) || 'Failed to load topology');
      }
      if (!env || env.success === false) {
        throw new Error((env && env.message) || 'Failed to load environment');
      }
      const cytoBlob = new Blob([JSON.stringify(cyto.elements || [])], { type: 'application/json' });
      const envBlob = new Blob([JSON.stringify(env.environment || {})], { type: 'application/json' });
      window.jsonFileUrlDataCytoMarshall = URL.createObjectURL(cytoBlob);
      window.jsonFileUrlDataEnvironment = URL.createObjectURL(envBlob);
      loadModule();
    }).catch((err) => {
      document.body.innerHTML = '<div style="color:#e2e8f0;padding:20px;">Failed to load topology: ' + (err && err.message ? err.message : err) + '</div>';
    });
  })();
</script>

    </div>
  </body>
</html>
